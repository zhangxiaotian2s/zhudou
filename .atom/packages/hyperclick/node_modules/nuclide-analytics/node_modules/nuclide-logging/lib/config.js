var getServerLogAppenderConfig = _asyncToGenerator(function* () {
  // Skip config scribe_cat logger if
  // 1) running in test environment
  // 2) or running in Atom client
  // 3) or running in open sourced version of nuclide
  // 4) or the scribe_cat command is missing.
  if (clientInfo.isRunningInTest() || clientInfo.isRunningInClient() || !(yield fsPromise.exists(scribeAppenderPath)) || !(yield ScribeProcess.isScribeCatOnPath())) {
    return null;
  }

  return {
    type: 'logLevelFilter',
    level: 'DEBUG',
    appender: {
      type: scribeAppenderPath,
      scribeCategory: 'errorlog_arsenal'
    }
  };
}

/**
 * @return The absolute path to the log file for the specified date.
 */
);

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

'use babel';

var _require = require('nuclide-commons');

var clientInfo = _require.clientInfo;
var fsPromise = _require.fsPromise;
var systemInfo = _require.systemInfo;
var ScribeProcess = _require.ScribeProcess;

var os = require('os');
var path = require('path');

var USER = require('nuclide-commons').env.USER;

var LOG_FILE_PATH = undefined;

if (systemInfo.isRunningInWindows()) {
  LOG_FILE_PATH = path.join(os.tmpdir(), '/nuclide-' + USER + '-logs/nuclide.log');
} else {
  LOG_FILE_PATH = '/tmp/nuclide-' + USER + '-logs/nuclide.log';
}

var logDirectory = path.dirname(LOG_FILE_PATH);
var logDirectoryInitialized = false;
var scribeAppenderPath = path.join(__dirname, '../fb/scribeAppender.js');

var LOG4JS_DATE_FORMAT = '-yyyy-MM-dd';

function getPathToLogFileForDate(targetDate) {
  var log4jsFormatter = require('log4js/lib/date_format').asString;
  return LOG_FILE_PATH + log4jsFormatter(LOG4JS_DATE_FORMAT, targetDate);
}

/**
 * @return The absolute path to the log file for today.
 */
function getPathToLogFileForToday() {
  return getPathToLogFileForDate(new Date());
}

module.exports = {
  getDefaultConfig: _asyncToGenerator(function* () {

    if (!logDirectoryInitialized) {
      yield fsPromise.mkdirp(logDirectory);
      logDirectoryInitialized = true;
    }

    var config = {
      appenders: [{
        type: 'logLevelFilter',
        level: 'INFO',
        appender: {
          type: path.join(__dirname, './consoleAppender')
        }
      }, {
        type: 'dateFile',
        alwaysIncludePattern: true,
        absolute: true,
        filename: LOG_FILE_PATH,
        pattern: LOG4JS_DATE_FORMAT,
        layout: {
          type: 'pattern',
          // Format log in following pattern:
          // yyyy-MM-dd HH:mm:ss.mil $Level (pid:$pid) $categroy - $message.
          pattern: '%d{ISO8601} %p (pid:' + process.pid + ') %c - %m'
        }
      }]
    };

    var serverLogAppenderConfig = yield getServerLogAppenderConfig();
    if (serverLogAppenderConfig) {
      config.appenders.push(serverLogAppenderConfig);
    }

    return config;
  }),
  getPathToLogFileForToday: getPathToLogFileForToday,
  LOG_FILE_PATH: LOG_FILE_PATH,
  __test__: {
    getPathToLogFileForDate: getPathToLogFileForDate
  }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBwZmw1Mm5wdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLWxvZ2dpbmcvbGliL2NvbmZpZy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiSUE4QmUsMEJBQTBCLHFCQUF6QyxhQUE4RDs7Ozs7O0FBTTVELE1BQUksVUFBVSxDQUFDLGVBQWUsRUFBRSxJQUM1QixVQUFVLENBQUMsaUJBQWlCLEVBQUUsSUFDOUIsRUFBRSxNQUFNLFNBQVMsQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQSxBQUFDLElBQzdDLEVBQUUsTUFBTSxhQUFhLENBQUMsaUJBQWlCLEVBQUUsQ0FBQSxBQUFDLEVBQUU7QUFDOUMsV0FBTyxJQUFJLENBQUM7R0FDYjs7QUFFRCxTQUFPO0FBQ0wsUUFBSSxFQUFFLGdCQUFnQjtBQUN0QixTQUFLLEVBQUUsT0FBTztBQUNkLFlBQVEsRUFBRTtBQUNSLFVBQUksRUFBRSxrQkFBa0I7QUFDeEIsb0JBQWMsRUFBRSxrQkFBa0I7S0FDbkM7R0FDRixDQUFDO0NBQ0g7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbkRELFdBQVcsQ0FBQzs7ZUFZK0MsT0FBTyxDQUFDLGlCQUFpQixDQUFDOztJQUE5RSxVQUFVLFlBQVYsVUFBVTtJQUFFLFNBQVMsWUFBVCxTQUFTO0lBQUUsVUFBVSxZQUFWLFVBQVU7SUFBRSxhQUFhLFlBQWIsYUFBYTs7QUFDdkQsSUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3pCLElBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQzs7SUFDdEIsSUFBSSxHQUFJLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLEdBQUcsQ0FBdEMsSUFBSTs7QUFDWCxJQUFJLGFBQWEsWUFBQSxDQUFDOztBQUVsQixJQUFJLFVBQVUsQ0FBQyxrQkFBa0IsRUFBRSxFQUFFO0FBQ25DLGVBQWEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsZ0JBQWMsSUFBSSx1QkFBb0IsQ0FBQztDQUM3RSxNQUFNO0FBQ0wsZUFBYSxxQkFBbUIsSUFBSSxzQkFBbUIsQ0FBQztDQUN6RDs7QUFFRCxJQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ2pELElBQUksdUJBQXVCLEdBQUcsS0FBSyxDQUFDO0FBQ3BDLElBQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUseUJBQXlCLENBQUMsQ0FBQzs7QUFFM0UsSUFBTSxrQkFBa0IsR0FBRyxhQUFhLENBQUM7O0FBNEJ6QyxTQUFTLHVCQUF1QixDQUFDLFVBQWdCLEVBQVU7QUFDekQsTUFBTSxlQUFlLEdBQUcsT0FBTyxDQUFDLHdCQUF3QixDQUFDLENBQUMsUUFBUSxDQUFDO0FBQ25FLFNBQU8sYUFBYSxHQUFHLGVBQWUsQ0FBQyxrQkFBa0IsRUFBRSxVQUFVLENBQUMsQ0FBQztDQUN4RTs7Ozs7QUFLRCxTQUFTLHdCQUF3QixHQUFXO0FBQzFDLFNBQU8sdUJBQXVCLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0NBQzVDOztBQUVELE1BQU0sQ0FBQyxPQUFPLEdBQUc7QUFDZixBQUFNLGtCQUFnQixvQkFBQSxhQUE2Qjs7QUFFakQsUUFBSSxDQUFDLHVCQUF1QixFQUFFO0FBQzVCLFlBQU0sU0FBUyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUNyQyw2QkFBdUIsR0FBRyxJQUFJLENBQUM7S0FDaEM7O0FBRUQsUUFBTSxNQUFNLEdBQUc7QUFDYixlQUFTLEVBQUUsQ0FDVDtBQUNFLFlBQUksRUFBRSxnQkFBZ0I7QUFDdEIsYUFBSyxFQUFFLE1BQU07QUFDYixnQkFBUSxFQUFFO0FBQ1IsY0FBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLG1CQUFtQixDQUFDO1NBQ2hEO09BQ0YsRUFDRDtBQUNFLFlBQUksRUFBRSxVQUFVO0FBQ2hCLDRCQUFvQixFQUFFLElBQUk7QUFDMUIsZ0JBQVEsRUFBRSxJQUFJO0FBQ2QsZ0JBQVEsRUFBRSxhQUFhO0FBQ3ZCLGVBQU8sRUFBRSxrQkFBa0I7QUFDM0IsY0FBTSxFQUFFO0FBQ04sY0FBSSxFQUFFLFNBQVM7OztBQUdmLGlCQUFPLDJCQUF5QixPQUFPLENBQUMsR0FBRyxjQUFXO1NBQ3ZEO09BQ0YsQ0FDRjtLQUNGLENBQUM7O0FBRUYsUUFBTSx1QkFBdUIsR0FBRyxNQUFNLDBCQUEwQixFQUFFLENBQUM7QUFDbkUsUUFBSSx1QkFBdUIsRUFBRTtBQUMzQixZQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0tBQ2hEOztBQUVELFdBQU8sTUFBTSxDQUFDO0dBQ2YsQ0FBQTtBQUNELDBCQUF3QixFQUF4Qix3QkFBd0I7QUFDeEIsZUFBYSxFQUFiLGFBQWE7QUFDYixVQUFRLEVBQUU7QUFDUiwyQkFBdUIsRUFBdkIsdUJBQXVCO0dBQ3hCO0NBQ0YsQ0FBQyIsImZpbGUiOiIvdmFyL2ZvbGRlcnMveGYvcnNwaDRfYzU3MzE1cnM1N3h4c2Rza3J4bnYzNnQwL1QvdG1wcGZsNTJucHVibGlzaF9wYWNrYWdlcy9ucG0vbnVjbGlkZS1sb2dnaW5nL2xpYi9jb25maWcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJztcbi8qIEBmbG93ICovXG5cbi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgbGljZW5zZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGluXG4gKiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG5pbXBvcnQgdHlwZSB7TG9nZ2luZ0FwcGVuZGVyfSBmcm9tICcuL3R5cGVzJztcbmNvbnN0IHtjbGllbnRJbmZvLCBmc1Byb21pc2UsIHN5c3RlbUluZm8sIFNjcmliZVByb2Nlc3N9ID0gcmVxdWlyZSgnbnVjbGlkZS1jb21tb25zJyk7XG5jb25zdCBvcyA9IHJlcXVpcmUoJ29zJyk7XG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3Qge1VTRVJ9ID0gcmVxdWlyZSgnbnVjbGlkZS1jb21tb25zJykuZW52O1xubGV0IExPR19GSUxFX1BBVEg7XG5cbmlmIChzeXN0ZW1JbmZvLmlzUnVubmluZ0luV2luZG93cygpKSB7XG4gIExPR19GSUxFX1BBVEggPSBwYXRoLmpvaW4ob3MudG1wZGlyKCksIGAvbnVjbGlkZS0ke1VTRVJ9LWxvZ3MvbnVjbGlkZS5sb2dgKTtcbn0gZWxzZSB7XG4gIExPR19GSUxFX1BBVEggPSBgL3RtcC9udWNsaWRlLSR7VVNFUn0tbG9ncy9udWNsaWRlLmxvZ2A7XG59XG5cbmNvbnN0IGxvZ0RpcmVjdG9yeSA9IHBhdGguZGlybmFtZShMT0dfRklMRV9QQVRIKTtcbmxldCBsb2dEaXJlY3RvcnlJbml0aWFsaXplZCA9IGZhbHNlO1xuY29uc3Qgc2NyaWJlQXBwZW5kZXJQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL2ZiL3NjcmliZUFwcGVuZGVyLmpzJyk7XG5cbmNvbnN0IExPRzRKU19EQVRFX0ZPUk1BVCA9ICcteXl5eS1NTS1kZCc7XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlckxvZ0FwcGVuZGVyQ29uZmlnKCk6IFByb21pc2U8P09iamVjdD4ge1xuICAvLyBTa2lwIGNvbmZpZyBzY3JpYmVfY2F0IGxvZ2dlciBpZlxuICAvLyAxKSBydW5uaW5nIGluIHRlc3QgZW52aXJvbm1lbnRcbiAgLy8gMikgb3IgcnVubmluZyBpbiBBdG9tIGNsaWVudFxuICAvLyAzKSBvciBydW5uaW5nIGluIG9wZW4gc291cmNlZCB2ZXJzaW9uIG9mIG51Y2xpZGVcbiAgLy8gNCkgb3IgdGhlIHNjcmliZV9jYXQgY29tbWFuZCBpcyBtaXNzaW5nLlxuICBpZiAoY2xpZW50SW5mby5pc1J1bm5pbmdJblRlc3QoKSB8fFxuICAgICAgY2xpZW50SW5mby5pc1J1bm5pbmdJbkNsaWVudCgpIHx8XG4gICAgICAhKGF3YWl0IGZzUHJvbWlzZS5leGlzdHMoc2NyaWJlQXBwZW5kZXJQYXRoKSkgfHxcbiAgICAgICEoYXdhaXQgU2NyaWJlUHJvY2Vzcy5pc1NjcmliZUNhdE9uUGF0aCgpKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnbG9nTGV2ZWxGaWx0ZXInLFxuICAgIGxldmVsOiAnREVCVUcnLFxuICAgIGFwcGVuZGVyOiB7XG4gICAgICB0eXBlOiBzY3JpYmVBcHBlbmRlclBhdGgsXG4gICAgICBzY3JpYmVDYXRlZ29yeTogJ2Vycm9ybG9nX2Fyc2VuYWwnLFxuICAgIH0sXG4gIH07XG59XG5cbi8qKlxuICogQHJldHVybiBUaGUgYWJzb2x1dGUgcGF0aCB0byB0aGUgbG9nIGZpbGUgZm9yIHRoZSBzcGVjaWZpZWQgZGF0ZS5cbiAqL1xuZnVuY3Rpb24gZ2V0UGF0aFRvTG9nRmlsZUZvckRhdGUodGFyZ2V0RGF0ZTogRGF0ZSk6IHN0cmluZyB7XG4gIGNvbnN0IGxvZzRqc0Zvcm1hdHRlciA9IHJlcXVpcmUoJ2xvZzRqcy9saWIvZGF0ZV9mb3JtYXQnKS5hc1N0cmluZztcbiAgcmV0dXJuIExPR19GSUxFX1BBVEggKyBsb2c0anNGb3JtYXR0ZXIoTE9HNEpTX0RBVEVfRk9STUFULCB0YXJnZXREYXRlKTtcbn1cblxuLyoqXG4gKiBAcmV0dXJuIFRoZSBhYnNvbHV0ZSBwYXRoIHRvIHRoZSBsb2cgZmlsZSBmb3IgdG9kYXkuXG4gKi9cbmZ1bmN0aW9uIGdldFBhdGhUb0xvZ0ZpbGVGb3JUb2RheSgpOiBzdHJpbmcge1xuICByZXR1cm4gZ2V0UGF0aFRvTG9nRmlsZUZvckRhdGUobmV3IERhdGUoKSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBhc3luYyBnZXREZWZhdWx0Q29uZmlnKCk6IFByb21pc2U8TG9nZ2luZ0FwcGVuZGVyPiB7XG5cbiAgICBpZiAoIWxvZ0RpcmVjdG9yeUluaXRpYWxpemVkKSB7XG4gICAgICBhd2FpdCBmc1Byb21pc2UubWtkaXJwKGxvZ0RpcmVjdG9yeSk7XG4gICAgICBsb2dEaXJlY3RvcnlJbml0aWFsaXplZCA9IHRydWU7XG4gICAgfVxuXG4gICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgYXBwZW5kZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAnbG9nTGV2ZWxGaWx0ZXInLFxuICAgICAgICAgIGxldmVsOiAnSU5GTycsXG4gICAgICAgICAgYXBwZW5kZXI6IHtcbiAgICAgICAgICAgIHR5cGU6IHBhdGguam9pbihfX2Rpcm5hbWUsICcuL2NvbnNvbGVBcHBlbmRlcicpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAnZGF0ZUZpbGUnLFxuICAgICAgICAgIGFsd2F5c0luY2x1ZGVQYXR0ZXJuOiB0cnVlLFxuICAgICAgICAgIGFic29sdXRlOiB0cnVlLFxuICAgICAgICAgIGZpbGVuYW1lOiBMT0dfRklMRV9QQVRILFxuICAgICAgICAgIHBhdHRlcm46IExPRzRKU19EQVRFX0ZPUk1BVCxcbiAgICAgICAgICBsYXlvdXQ6IHtcbiAgICAgICAgICAgIHR5cGU6ICdwYXR0ZXJuJyxcbiAgICAgICAgICAgIC8vIEZvcm1hdCBsb2cgaW4gZm9sbG93aW5nIHBhdHRlcm46XG4gICAgICAgICAgICAvLyB5eXl5LU1NLWRkIEhIOm1tOnNzLm1pbCAkTGV2ZWwgKHBpZDokcGlkKSAkY2F0ZWdyb3kgLSAkbWVzc2FnZS5cbiAgICAgICAgICAgIHBhdHRlcm46IGAlZHtJU084NjAxfSAlcCAocGlkOiR7cHJvY2Vzcy5waWR9KSAlYyAtICVtYCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9O1xuXG4gICAgY29uc3Qgc2VydmVyTG9nQXBwZW5kZXJDb25maWcgPSBhd2FpdCBnZXRTZXJ2ZXJMb2dBcHBlbmRlckNvbmZpZygpO1xuICAgIGlmIChzZXJ2ZXJMb2dBcHBlbmRlckNvbmZpZykge1xuICAgICAgY29uZmlnLmFwcGVuZGVycy5wdXNoKHNlcnZlckxvZ0FwcGVuZGVyQ29uZmlnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY29uZmlnO1xuICB9LFxuICBnZXRQYXRoVG9Mb2dGaWxlRm9yVG9kYXksXG4gIExPR19GSUxFX1BBVEgsXG4gIF9fdGVzdF9fOiB7XG4gICAgZ2V0UGF0aFRvTG9nRmlsZUZvckRhdGUsXG4gIH0sXG59O1xuIl19
