Object.defineProperty(exports, '__esModule', {
  value: true
});

/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();

var getHackExecOptions = _asyncToGenerator(function* (localFile) {
  // $FlowFixMe incompatible type.

  var _ref = yield Promise.all([
  // `stdout` would be empty if there is no such command.
  (0, _nuclideCommons.checkOutput)('which', [PATH_TO_HH_CLIENT]), findHackConfigDir(localFile)]);

  var _ref2 = _slicedToArray(_ref, 2);

  var hhResult = _ref2[0];
  var hackRoot = _ref2[1];

  var hackCommand = hhResult.stdout.trim();
  if (hackRoot && hackCommand) {
    return { hackRoot: hackRoot, hackCommand: hackCommand };
  } else {
    return null;
  }
}

/**
 * Executes hh_client with proper arguments returning the result string or json object.
 */
);

exports.getHackExecOptions = getHackExecOptions;

var callHHClient = _asyncToGenerator(function* (args, errorStream, outputJson, processInput, filePath) {

  if (!hhPromiseQueue) {
    hhPromiseQueue = new _nuclideCommons.PromiseQueue();
  }

  var hackExecOptions = yield getHackExecOptions(filePath);
  if (!hackExecOptions) {
    return null;
  }
  var hackRoot = hackExecOptions.hackRoot;

  (0, _assert2['default'])(hhPromiseQueue);
  return hhPromiseQueue.submit(_asyncToGenerator(function* (resolve, reject) {
    // Append args on the end of our commands.
    var defaults = ['--retries', '0', '--retry-if-init', 'false', '--from', 'nuclide'];
    if (outputJson) {
      defaults.unshift('--json');
    }

    var allArgs = defaults.concat(args);
    allArgs.push(hackRoot);

    var execResult = null;
    try {
      execResult = yield (0, _nuclideCommons.checkOutput)(PATH_TO_HH_CLIENT, allArgs, { stdin: processInput });
    } catch (err) {
      reject(err);
      return;
    }
    var _execResult = execResult;
    var stdout = _execResult.stdout;
    var stderr = _execResult.stderr;

    if (stderr.indexOf(HH_SERVER_INIT_MESSAGE) !== -1) {
      reject(new Error(HH_SERVER_INIT_MESSAGE + ': try: `arc build` or try again later!'));
      return;
    } else if (stderr.startsWith(HH_SERVER_BUSY_MESSAGE)) {
      reject(new Error(HH_SERVER_BUSY_MESSAGE + ': try: `arc build` or try again later!'));
      return;
    }

    var output = errorStream ? stderr : stdout;
    if (!outputJson) {
      resolve({ result: output, hackRoot: hackRoot });
      return;
    }
    try {
      resolve({ result: JSON.parse(output), hackRoot: hackRoot });
    } catch (err) {
      var errorMessage = 'hh_client error, args: [' + args.join(',') + ']\nstdout: ' + stdout + ', stderr: ' + stderr;
      logger.error(errorMessage);
      reject(new Error(errorMessage));
    }
  }));
});

exports.callHHClient = callHHClient;

var getSearchResults = _asyncToGenerator(function* (filePath, search, filterTypes, searchPostfix) {
  if (!search) {
    return null;
  }

  // `pendingSearchPromises` is used to temporally cache search result promises.
  // So, when a matching search query is done in parallel, it will wait and resolve
  // with the original search call.
  var searchPromise = pendingSearchPromises.get(search);
  if (!searchPromise) {
    searchPromise = callHHClient(
    /*args*/['--search' + (searchPostfix || ''), search],
    /*errorStream*/false,
    /*outputJson*/true,
    /*processInput*/null,
    /*file*/filePath);
    pendingSearchPromises.set(search, searchPromise);
  }

  var searchResponse = null;
  try {
    searchResponse = yield searchPromise;
  } catch (error) {
    throw error;
  } finally {
    pendingSearchPromises['delete'](search);
  }

  if (!searchResponse) {
    return null;
  }

  var _searchResponse = searchResponse;
  var searchResult = _searchResponse.result;
  var hackRoot = _searchResponse.hackRoot;

  var result = [];
  for (var entry of searchResult) {
    var resultFile = entry.filename;
    if (!resultFile.startsWith(hackRoot)) {
      // Filter out files out of repo results, e.g. hh internal files.
      continue;
    }
    result.push({
      line: entry.line - 1,
      column: entry.char_start - 1,
      name: entry.name,
      path: resultFile,
      length: entry.char_end - entry.char_start + 1,
      scope: entry.scope,
      additionalInfo: entry.desc
    });
  }

  if (filterTypes) {
    result = filterSearchResults(result, filterTypes);
  }
  return { hackRoot: hackRoot, result: result };
}

// Eventually this will happen on the hack side, but for now, this will do.
);

exports.getSearchResults = getSearchResults;
exports.symbolTypeToSearchTypes = symbolTypeToSearchTypes;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _assert = require('assert');

var _assert2 = _interopRequireDefault(_assert);

var _nuclideCommons = require('nuclide-commons');

var _nuclideHackCommonLibConstants = require('nuclide-hack-common/lib/constants');

'use babel';

var PATH_TO_HH_CLIENT = 'hh_client';
var HH_SERVER_INIT_MESSAGE = 'hh_server still initializing';
var HH_SERVER_BUSY_MESSAGE = 'hh_server is busy';
var logger = require('nuclide-logging').getLogger();

var hhPromiseQueue = null;
var pendingSearchPromises = new Map();

var SYMBOL_CLASS_SEARCH_TYPES = Object.freeze([_nuclideHackCommonLibConstants.SearchResultType.CLASS, _nuclideHackCommonLibConstants.SearchResultType.ABSTRACT_CLASS, _nuclideHackCommonLibConstants.SearchResultType.TRAIT, _nuclideHackCommonLibConstants.SearchResultType.TYPEDEF, _nuclideHackCommonLibConstants.SearchResultType.INTERFACE]);
var SYMBOL_METHOD_SEARCH_TYPES = Object.freeze([_nuclideHackCommonLibConstants.SearchResultType.METHOD]);
var SYMBOL_FUNCTION_SEARCH_TYPES = Object.freeze([_nuclideHackCommonLibConstants.SearchResultType.FUNCTION]);

/**
* If this returns null, then it is not safe to run hack.
*/
function findHackConfigDir(localFile) {
  return (0, _nuclideCommons.findNearestFile)('.hhconfig', localFile);
}

function filterSearchResults(results, filter) {
  return results.filter(function (result) {
    var info = result.additionalInfo;
    var searchType = getSearchType(info);
    return filter.indexOf(searchType) !== -1;
  });
}

function getSearchType(info) {
  switch (info) {
    case 'typedef':
      return _nuclideHackCommonLibConstants.SearchResultType.TYPEDEF;
    case 'function':
      return _nuclideHackCommonLibConstants.SearchResultType.FUNCTION;
    case 'constant':
      return _nuclideHackCommonLibConstants.SearchResultType.CONSTANT;
    case 'trait':
      return _nuclideHackCommonLibConstants.SearchResultType.TRAIT;
    case 'interface':
      return _nuclideHackCommonLibConstants.SearchResultType.INTERFACE;
    case 'abstract class':
      return _nuclideHackCommonLibConstants.SearchResultType.ABSTRACT_CLASS;
    default:
      {
        if (info.startsWith('method') || info.startsWith('static method')) {
          return _nuclideHackCommonLibConstants.SearchResultType.METHOD;
        }
        if (info.startsWith('class var') || info.startsWith('static class var')) {
          return _nuclideHackCommonLibConstants.SearchResultType.CLASS_VAR;
        }
        return _nuclideHackCommonLibConstants.SearchResultType.CLASS;
      }
  }
}

function symbolTypeToSearchTypes(symbolType) {
  switch (symbolType) {
    case _nuclideHackCommonLibConstants.SymbolType.CLASS:
      return SYMBOL_CLASS_SEARCH_TYPES;
    case _nuclideHackCommonLibConstants.SymbolType.METHOD:
      return SYMBOL_METHOD_SEARCH_TYPES;
    case _nuclideHackCommonLibConstants.SymbolType.FUNCTION:
      return SYMBOL_FUNCTION_SEARCH_TYPES;
    default:
      return null;
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBwZmw1Mm5wdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLWhhY2stYmFzZS9saWIvSGFja0hlbHBlcnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7SUE0Q3NCLGtCQUFrQixxQkFBakMsV0FDTCxTQUFpQixFQUNrQzs7O2FBRXRCLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQzs7QUFFN0Msc0JBbENxQixXQUFXLEVBa0NwQixPQUFPLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLEVBQ3pDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUM3QixDQUFDOzs7O01BSkssUUFBUTtNQUFFLFFBQVE7O0FBS3pCLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDM0MsTUFBSSxRQUFRLElBQUksV0FBVyxFQUFFO0FBQzNCLFdBQU8sRUFBQyxRQUFRLEVBQVIsUUFBUSxFQUFFLFdBQVcsRUFBWCxXQUFXLEVBQUMsQ0FBQztHQUNoQyxNQUFNO0FBQ0wsV0FBTyxJQUFJLENBQUM7R0FDYjtDQUNGOzs7Ozs7Ozs7SUFLcUIsWUFBWSxxQkFBM0IsV0FDTCxJQUFtQixFQUNuQixXQUFvQixFQUNwQixVQUFtQixFQUNuQixZQUFxQixFQUNyQixRQUFnQixFQUF5RDs7QUFFekUsTUFBSSxDQUFDLGNBQWMsRUFBRTtBQUNuQixrQkFBYyxHQUFHLG9CQXhEaUIsWUFBWSxFQXdEWCxDQUFDO0dBQ3JDOztBQUVELE1BQU0sZUFBZSxHQUFHLE1BQU0sa0JBQWtCLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDM0QsTUFBSSxDQUFDLGVBQWUsRUFBRTtBQUNwQixXQUFPLElBQUksQ0FBQztHQUNiO01BQ00sUUFBUSxHQUFJLGVBQWUsQ0FBM0IsUUFBUTs7QUFFZiwyQkFBVSxjQUFjLENBQUMsQ0FBQztBQUMxQixTQUFP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QixVQUFRLFVBQVU7QUFDaEIsU0FBSywrQkF0TmlCLFVBQVUsQ0FzTmhCLEtBQUs7QUFDbkIsYUFBTyx5QkFBeUIsQ0FBQztBQUFBLEFBQ25DLFNBQUssK0JBeE5pQixVQUFVLENBd05oQixNQUFNO0FBQ3BCLGFBQU8sMEJBQTBCLENBQUM7QUFBQSxBQUNwQyxTQUFLLCtCQTFOaUIsVUFBVSxDQTBOaEIsUUFBUTtBQUN0QixhQUFPLDRCQUE0QixDQUFDO0FBQUEsQUFDdEM7QUFDRSxhQUFPLElBQUksQ0FBQztBQUFBLEdBQ2Y7Q0FDRiIsImZpbGUiOiIvdmFyL2ZvbGRlcnMveGYvcnNwaDRfYzU3MzE1cnM1N3h4c2Rza3J4bnYzNnQwL1QvdG1wcGZsNTJucHVibGlzaF9wYWNrYWdlcy9ucG0vbnVjbGlkZS1oYWNrLWJhc2UvbGliL0hhY2tIZWxwZXJzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG4vKiBAZmxvdyAqL1xuXG4vKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIGxpY2Vuc2UgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpblxuICogdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxuaW1wb3J0IHR5cGUge0hhY2tTZWFyY2hSZXN1bHQsIEhhY2tTZWFyY2hQb3NpdGlvbiwgSEhTZWFyY2hQb3NpdGlvbn0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgdHlwZSB7U2VhcmNoUmVzdWx0VHlwZVZhbHVlLCBTeW1ib2xUeXBlVmFsdWV9IGZyb20gJ251Y2xpZGUtaGFjay1jb21tb24vbGliL2NvbnN0YW50cyc7XG5cbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGludmFyaWFudCBmcm9tICdhc3NlcnQnO1xuaW1wb3J0IHtmaW5kTmVhcmVzdEZpbGUsIGNoZWNrT3V0cHV0LCBQcm9taXNlUXVldWV9IGZyb20gJ251Y2xpZGUtY29tbW9ucyc7XG5pbXBvcnQge1NlYXJjaFJlc3VsdFR5cGUsIFN5bWJvbFR5cGV9IGZyb20gJ251Y2xpZGUtaGFjay1jb21tb24vbGliL2NvbnN0YW50cyc7XG5cbmNvbnN0IFBBVEhfVE9fSEhfQ0xJRU5UID0gJ2hoX2NsaWVudCc7XG5jb25zdCBISF9TRVJWRVJfSU5JVF9NRVNTQUdFID0gJ2hoX3NlcnZlciBzdGlsbCBpbml0aWFsaXppbmcnO1xuY29uc3QgSEhfU0VSVkVSX0JVU1lfTUVTU0FHRSA9ICdoaF9zZXJ2ZXIgaXMgYnVzeSc7XG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKCdudWNsaWRlLWxvZ2dpbmcnKS5nZXRMb2dnZXIoKTtcblxubGV0IGhoUHJvbWlzZVF1ZXVlOiA/UHJvbWlzZVF1ZXVlID0gbnVsbDtcbmNvbnN0IHBlbmRpbmdTZWFyY2hQcm9taXNlczogTWFwPHN0cmluZywgUHJvbWlzZT4gPSBuZXcgTWFwKCk7XG5cbmNvbnN0IFNZTUJPTF9DTEFTU19TRUFSQ0hfVFlQRVMgPSBPYmplY3QuZnJlZXplKFtcbiAgU2VhcmNoUmVzdWx0VHlwZS5DTEFTUyxcbiAgU2VhcmNoUmVzdWx0VHlwZS5BQlNUUkFDVF9DTEFTUyxcbiAgU2VhcmNoUmVzdWx0VHlwZS5UUkFJVCxcbiAgU2VhcmNoUmVzdWx0VHlwZS5UWVBFREVGLFxuICBTZWFyY2hSZXN1bHRUeXBlLklOVEVSRkFDRSxcbl0pO1xuY29uc3QgU1lNQk9MX01FVEhPRF9TRUFSQ0hfVFlQRVMgPSBPYmplY3QuZnJlZXplKFtTZWFyY2hSZXN1bHRUeXBlLk1FVEhPRF0pO1xuY29uc3QgU1lNQk9MX0ZVTkNUSU9OX1NFQVJDSF9UWVBFUyA9IE9iamVjdC5mcmVlemUoW1NlYXJjaFJlc3VsdFR5cGUuRlVOQ1RJT05dKTtcblxuLyoqXG4qIElmIHRoaXMgcmV0dXJucyBudWxsLCB0aGVuIGl0IGlzIG5vdCBzYWZlIHRvIHJ1biBoYWNrLlxuKi9cbmZ1bmN0aW9uIGZpbmRIYWNrQ29uZmlnRGlyKGxvY2FsRmlsZTogc3RyaW5nKTogUHJvbWlzZTw/c3RyaW5nPiB7XG4gIHJldHVybiBmaW5kTmVhcmVzdEZpbGUoJy5oaGNvbmZpZycsIGxvY2FsRmlsZSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRIYWNrRXhlY09wdGlvbnMoXG4gIGxvY2FsRmlsZTogc3RyaW5nXG4pOiBQcm9taXNlPD97aGFja1Jvb3Q6IHN0cmluZywgaGFja0NvbW1hbmQ6IHN0cmluZ30+IHtcbiAgLy8gJEZsb3dGaXhNZSBpbmNvbXBhdGlibGUgdHlwZS5cbiAgY29uc3QgW2hoUmVzdWx0LCBoYWNrUm9vdF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgLy8gYHN0ZG91dGAgd291bGQgYmUgZW1wdHkgaWYgdGhlcmUgaXMgbm8gc3VjaCBjb21tYW5kLlxuICAgIGNoZWNrT3V0cHV0KCd3aGljaCcsIFtQQVRIX1RPX0hIX0NMSUVOVF0pLFxuICAgIGZpbmRIYWNrQ29uZmlnRGlyKGxvY2FsRmlsZSksXG4gIF0pO1xuICBjb25zdCBoYWNrQ29tbWFuZCA9IGhoUmVzdWx0LnN0ZG91dC50cmltKCk7XG4gIGlmIChoYWNrUm9vdCAmJiBoYWNrQ29tbWFuZCkge1xuICAgIHJldHVybiB7aGFja1Jvb3QsIGhhY2tDb21tYW5kfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4gLyoqXG4gICogRXhlY3V0ZXMgaGhfY2xpZW50IHdpdGggcHJvcGVyIGFyZ3VtZW50cyByZXR1cm5pbmcgdGhlIHJlc3VsdCBzdHJpbmcgb3IganNvbiBvYmplY3QuXG4gICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2FsbEhIQ2xpZW50KFxuICBhcmdzOiBBcnJheTxzdHJpbmc+LFxuICBlcnJvclN0cmVhbTogYm9vbGVhbixcbiAgb3V0cHV0SnNvbjogYm9vbGVhbixcbiAgcHJvY2Vzc0lucHV0OiA/c3RyaW5nLFxuICBmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTw/e2hhY2tSb290OiBzdHJpbmcsIHJlc3VsdDogc3RyaW5nIHwgT2JqZWN0fT4ge1xuXG4gIGlmICghaGhQcm9taXNlUXVldWUpIHtcbiAgICBoaFByb21pc2VRdWV1ZSA9IG5ldyBQcm9taXNlUXVldWUoKTtcbiAgfVxuXG4gIGNvbnN0IGhhY2tFeGVjT3B0aW9ucyA9IGF3YWl0IGdldEhhY2tFeGVjT3B0aW9ucyhmaWxlUGF0aCk7XG4gIGlmICghaGFja0V4ZWNPcHRpb25zKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3Qge2hhY2tSb290fSA9IGhhY2tFeGVjT3B0aW9ucztcblxuICBpbnZhcmlhbnQoaGhQcm9taXNlUXVldWUpO1xuICByZXR1cm4gaGhQcm9taXNlUXVldWUuc3VibWl0KGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAvLyBBcHBlbmQgYXJncyBvbiB0aGUgZW5kIG9mIG91ciBjb21tYW5kcy5cbiAgICBjb25zdCBkZWZhdWx0cyA9IFsnLS1yZXRyaWVzJywgJzAnLCAnLS1yZXRyeS1pZi1pbml0JywgJ2ZhbHNlJywgJy0tZnJvbScsICdudWNsaWRlJ107XG4gICAgaWYgKG91dHB1dEpzb24pIHtcbiAgICAgIGRlZmF1bHRzLnVuc2hpZnQoJy0tanNvbicpO1xuICAgIH1cblxuICAgIGNvbnN0IGFsbEFyZ3MgPSBkZWZhdWx0cy5jb25jYXQoYXJncyk7XG4gICAgYWxsQXJncy5wdXNoKGhhY2tSb290KTtcblxuICAgIGxldCBleGVjUmVzdWx0ID0gbnVsbDtcbiAgICB0cnkge1xuICAgICAgZXhlY1Jlc3VsdCA9IGF3YWl0IGNoZWNrT3V0cHV0KFBBVEhfVE9fSEhfQ0xJRU5ULCBhbGxBcmdzLCB7c3RkaW46IHByb2Nlc3NJbnB1dH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmVqZWN0KGVycik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHtzdGRvdXQsIHN0ZGVycn0gPSBleGVjUmVzdWx0O1xuICAgIGlmIChzdGRlcnIuaW5kZXhPZihISF9TRVJWRVJfSU5JVF9NRVNTQUdFKSAhPT0gLTEpIHtcbiAgICAgIHJlamVjdChuZXcgRXJyb3IoYCR7SEhfU0VSVkVSX0lOSVRfTUVTU0FHRX06IHRyeTogXFxgYXJjIGJ1aWxkXFxgIG9yIHRyeSBhZ2FpbiBsYXRlciFgKSk7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmIChzdGRlcnIuc3RhcnRzV2l0aChISF9TRVJWRVJfQlVTWV9NRVNTQUdFKSkge1xuICAgICAgcmVqZWN0KG5ldyBFcnJvcihgJHtISF9TRVJWRVJfQlVTWV9NRVNTQUdFfTogdHJ5OiBcXGBhcmMgYnVpbGRcXGAgb3IgdHJ5IGFnYWluIGxhdGVyIWApKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBvdXRwdXQgPSBlcnJvclN0cmVhbSA/IHN0ZGVyciA6IHN0ZG91dDtcbiAgICBpZiAoIW91dHB1dEpzb24pIHtcbiAgICAgIHJlc29sdmUoe3Jlc3VsdDogb3V0cHV0LCBoYWNrUm9vdH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgcmVzb2x2ZSh7cmVzdWx0OiBKU09OLnBhcnNlKG91dHB1dCksIGhhY2tSb290fSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBgaGhfY2xpZW50IGVycm9yLCBhcmdzOiBbJHthcmdzLmpvaW4oJywnKX1dXG5zdGRvdXQ6ICR7c3Rkb3V0fSwgc3RkZXJyOiAke3N0ZGVycn1gO1xuICAgICAgbG9nZ2VyLmVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgICByZWplY3QobmV3IEVycm9yKGVycm9yTWVzc2FnZSkpO1xuICAgIH1cbiAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZWFyY2hSZXN1bHRzKFxuICAgIGZpbGVQYXRoOiBzdHJpbmcsXG4gICAgc2VhcmNoOiBzdHJpbmcsXG4gICAgZmlsdGVyVHlwZXM/OiA/QXJyYXk8U2VhcmNoUmVzdWx0VHlwZVZhbHVlPixcbiAgICBzZWFyY2hQb3N0Zml4Pzogc3RyaW5nLFxuICApOiBQcm9taXNlPD9IYWNrU2VhcmNoUmVzdWx0PiB7XG4gIGlmICghc2VhcmNoKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvLyBgcGVuZGluZ1NlYXJjaFByb21pc2VzYCBpcyB1c2VkIHRvIHRlbXBvcmFsbHkgY2FjaGUgc2VhcmNoIHJlc3VsdCBwcm9taXNlcy5cbiAgLy8gU28sIHdoZW4gYSBtYXRjaGluZyBzZWFyY2ggcXVlcnkgaXMgZG9uZSBpbiBwYXJhbGxlbCwgaXQgd2lsbCB3YWl0IGFuZCByZXNvbHZlXG4gIC8vIHdpdGggdGhlIG9yaWdpbmFsIHNlYXJjaCBjYWxsLlxuICBsZXQgc2VhcmNoUHJvbWlzZSA9IHBlbmRpbmdTZWFyY2hQcm9taXNlcy5nZXQoc2VhcmNoKTtcbiAgaWYgKCFzZWFyY2hQcm9taXNlKSB7XG4gICAgc2VhcmNoUHJvbWlzZSA9IGNhbGxISENsaWVudChcbiAgICAgICAgLyphcmdzKi8gWyctLXNlYXJjaCcgKyAoc2VhcmNoUG9zdGZpeCB8fCAnJyksIHNlYXJjaF0sXG4gICAgICAgIC8qZXJyb3JTdHJlYW0qLyBmYWxzZSxcbiAgICAgICAgLypvdXRwdXRKc29uKi8gdHJ1ZSxcbiAgICAgICAgLypwcm9jZXNzSW5wdXQqLyBudWxsLFxuICAgICAgICAvKmZpbGUqLyBmaWxlUGF0aCxcbiAgICApO1xuICAgIHBlbmRpbmdTZWFyY2hQcm9taXNlcy5zZXQoc2VhcmNoLCBzZWFyY2hQcm9taXNlKTtcbiAgfVxuXG4gIGxldCBzZWFyY2hSZXNwb25zZTogP3toYWNrUm9vdDogc3RyaW5nOyByZXN1bHQ6IEFycmF5PEhIU2VhcmNoUG9zaXRpb24+fSA9IG51bGw7XG4gIHRyeSB7XG4gICAgc2VhcmNoUmVzcG9uc2UgPSAoXG4gICAgICAoKGF3YWl0IHNlYXJjaFByb21pc2UpOiBhbnkpOiB7aGFja1Jvb3Q6IHN0cmluZzsgcmVzdWx0OiBBcnJheTxISFNlYXJjaFBvc2l0aW9uPn1cbiAgICApO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IGVycm9yO1xuICB9IGZpbmFsbHkge1xuICAgIHBlbmRpbmdTZWFyY2hQcm9taXNlcy5kZWxldGUoc2VhcmNoKTtcbiAgfVxuXG4gIGlmICghc2VhcmNoUmVzcG9uc2UpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IHtyZXN1bHQ6IHNlYXJjaFJlc3VsdCwgaGFja1Jvb3R9ID0gc2VhcmNoUmVzcG9uc2U7XG4gIGxldCByZXN1bHQ6IEFycmF5PEhhY2tTZWFyY2hQb3NpdGlvbj4gPSBbXTtcbiAgZm9yIChjb25zdCBlbnRyeSBvZiBzZWFyY2hSZXN1bHQpIHtcbiAgICBjb25zdCByZXN1bHRGaWxlID0gZW50cnkuZmlsZW5hbWU7XG4gICAgaWYgKCFyZXN1bHRGaWxlLnN0YXJ0c1dpdGgoaGFja1Jvb3QpKSB7XG4gICAgICAvLyBGaWx0ZXIgb3V0IGZpbGVzIG91dCBvZiByZXBvIHJlc3VsdHMsIGUuZy4gaGggaW50ZXJuYWwgZmlsZXMuXG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgcmVzdWx0LnB1c2goe1xuICAgICAgbGluZTogZW50cnkubGluZSAtIDEsXG4gICAgICBjb2x1bW46IGVudHJ5LmNoYXJfc3RhcnQgLSAxLFxuICAgICAgbmFtZTogZW50cnkubmFtZSxcbiAgICAgIHBhdGg6IHJlc3VsdEZpbGUsXG4gICAgICBsZW5ndGg6IGVudHJ5LmNoYXJfZW5kIC0gZW50cnkuY2hhcl9zdGFydCArIDEsXG4gICAgICBzY29wZTogZW50cnkuc2NvcGUsXG4gICAgICBhZGRpdGlvbmFsSW5mbzogZW50cnkuZGVzYyxcbiAgICB9KTtcbiAgfVxuXG4gIGlmIChmaWx0ZXJUeXBlcykge1xuICAgIHJlc3VsdCA9IGZpbHRlclNlYXJjaFJlc3VsdHMocmVzdWx0LCBmaWx0ZXJUeXBlcyk7XG4gIH1cbiAgcmV0dXJuIHtoYWNrUm9vdCwgcmVzdWx0fTtcbn1cblxuLy8gRXZlbnR1YWxseSB0aGlzIHdpbGwgaGFwcGVuIG9uIHRoZSBoYWNrIHNpZGUsIGJ1dCBmb3Igbm93LCB0aGlzIHdpbGwgZG8uXG5mdW5jdGlvbiBmaWx0ZXJTZWFyY2hSZXN1bHRzKFxuICByZXN1bHRzOiBBcnJheTxIYWNrU2VhcmNoUG9zaXRpb24+LFxuICBmaWx0ZXI6IEFycmF5PFNlYXJjaFJlc3VsdFR5cGVWYWx1ZT4sXG4pOiBBcnJheTxIYWNrU2VhcmNoUG9zaXRpb24+IHtcbiAgcmV0dXJuIHJlc3VsdHMuZmlsdGVyKChyZXN1bHQpID0+IHtcbiAgICBjb25zdCBpbmZvID0gcmVzdWx0LmFkZGl0aW9uYWxJbmZvO1xuICAgIGNvbnN0IHNlYXJjaFR5cGUgPSBnZXRTZWFyY2hUeXBlKGluZm8pO1xuICAgIHJldHVybiBmaWx0ZXIuaW5kZXhPZihzZWFyY2hUeXBlKSAhPT0gLTE7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRTZWFyY2hUeXBlKGluZm86IHN0cmluZyk6IFNlYXJjaFJlc3VsdFR5cGVWYWx1ZSB7XG4gIHN3aXRjaCAoaW5mbykge1xuICAgIGNhc2UgJ3R5cGVkZWYnOlxuICAgICAgcmV0dXJuIFNlYXJjaFJlc3VsdFR5cGUuVFlQRURFRjtcbiAgICBjYXNlICdmdW5jdGlvbic6XG4gICAgICByZXR1cm4gU2VhcmNoUmVzdWx0VHlwZS5GVU5DVElPTjtcbiAgICBjYXNlICdjb25zdGFudCc6XG4gICAgICByZXR1cm4gU2VhcmNoUmVzdWx0VHlwZS5DT05TVEFOVDtcbiAgICBjYXNlICd0cmFpdCc6XG4gICAgICByZXR1cm4gU2VhcmNoUmVzdWx0VHlwZS5UUkFJVDtcbiAgICBjYXNlICdpbnRlcmZhY2UnOlxuICAgICAgcmV0dXJuIFNlYXJjaFJlc3VsdFR5cGUuSU5URVJGQUNFO1xuICAgIGNhc2UgJ2Fic3RyYWN0IGNsYXNzJzpcbiAgICAgIHJldHVybiBTZWFyY2hSZXN1bHRUeXBlLkFCU1RSQUNUX0NMQVNTO1xuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGlmIChpbmZvLnN0YXJ0c1dpdGgoJ21ldGhvZCcpIHx8IGluZm8uc3RhcnRzV2l0aCgnc3RhdGljIG1ldGhvZCcpKSB7XG4gICAgICAgIHJldHVybiBTZWFyY2hSZXN1bHRUeXBlLk1FVEhPRDtcbiAgICAgIH1cbiAgICAgIGlmIChpbmZvLnN0YXJ0c1dpdGgoJ2NsYXNzIHZhcicpIHx8IGluZm8uc3RhcnRzV2l0aCgnc3RhdGljIGNsYXNzIHZhcicpKSB7XG4gICAgICAgIHJldHVybiBTZWFyY2hSZXN1bHRUeXBlLkNMQVNTX1ZBUjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBTZWFyY2hSZXN1bHRUeXBlLkNMQVNTO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc3ltYm9sVHlwZVRvU2VhcmNoVHlwZXMoXG4gIHN5bWJvbFR5cGU6IFN5bWJvbFR5cGVWYWx1ZSxcbik6ID9BcnJheTxTZWFyY2hSZXN1bHRUeXBlVmFsdWU+IHtcbiAgc3dpdGNoIChzeW1ib2xUeXBlKSB7XG4gICAgY2FzZSBTeW1ib2xUeXBlLkNMQVNTOlxuICAgICAgcmV0dXJuIFNZTUJPTF9DTEFTU19TRUFSQ0hfVFlQRVM7XG4gICAgY2FzZSBTeW1ib2xUeXBlLk1FVEhPRDpcbiAgICAgIHJldHVybiBTWU1CT0xfTUVUSE9EX1NFQVJDSF9UWVBFUztcbiAgICBjYXNlIFN5bWJvbFR5cGUuRlVOQ1RJT046XG4gICAgICByZXR1cm4gU1lNQk9MX0ZVTkNUSU9OX1NFQVJDSF9UWVBFUztcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cbiJdfQ==
