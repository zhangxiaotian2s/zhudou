
/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

/*
 * adapted from https://github.com/atom/underscore-plus/blob/master/src/underscore-plus.coffee
 */

var _require = require('nuclide-commons');

var array = _require.array;

var MAC_MODIFIER_KEYMAP = {
  alt: '⌥',
  cmd: '⌘',
  ctrl: '⌃',
  down: '↓',
  enter: '⏎',
  left: '←',
  option: '⌥',
  right: '→',
  shift: '⇧',
  up: '↑'
};

var NON_MAC_MODIFIER_KEYMAP = {
  alt: 'Alt',
  cmd: 'Cmd',
  ctrl: 'Ctrl',
  down: 'Down',
  enter: 'Enter',
  left: 'Left',
  option: 'Alt',
  right: 'Right',
  shift: 'Shift',
  up: 'Up'
};

// Human key combos should always explicitly state the shift key. This map is a disambiguator.
// 'shift-version': 'no-shift-version'
var SHIFT_KEYMAP = {
  '_': '-',
  ':': ';',
  '?': '/',
  '"': '\'',
  '{': '[',
  '}': ']',
  '+': '=',
  '<': ',',
  '>': '.',
  '|': '\\',
  '~': '`'
};

var FN_KEY_RE = /f[0-9]{1,2}/;

// $FlowIssue
function flatten(arr) {
  var flattened = [];
  for (var el of arr) {
    if (Array.isArray(el)) {
      flattened = flattened.concat(flatten(el));
    } else {
      flattened.push(el);
    }
  }
  return flattened;
}

function capitalize(word) {
  var first = word[0] || '';
  var rest = word.slice(1);
  return first.toUpperCase() + rest;
}

function humanizeKey(key, platform) {
  if (!key) {
    return key;
  }
  var modifierKeyMap = platform === 'darwin' ? MAC_MODIFIER_KEYMAP : NON_MAC_MODIFIER_KEYMAP;
  if (modifierKeyMap[key]) {
    return modifierKeyMap[key];
  }
  if (key.length === 1) {
    if (SHIFT_KEYMAP[key]) {
      return [modifierKeyMap.shift, SHIFT_KEYMAP[key]];
    }
    var uppercase = key.toUpperCase();
    if (key === uppercase && uppercase !== key.toLowerCase()) {
      return [modifierKeyMap.shift, uppercase];
    }
    return uppercase;
  }
  if (FN_KEY_RE.test(key)) {
    return key.toUpperCase();
  }
  return platform === 'darwin' ? key : capitalize(key);
}

/** Humanize the keystroke according to platform conventions. This method
 * attempts to mirror the text the given keystroke would have if displayed in
 * a system menu.
 *
 * @param keystroke A String keystroke to humanize such as `ctrl-O`.
 * @param platform An optional String platform to humanize for (default: `process.platform`).
 * @return a humanized representation of the keystroke.
 */
function humanizeKeystroke(keystroke, platform) {
  if (!keystroke) {
    return keystroke;
  }
  platform = platform || process.platform;
  var separator = platform === 'darwin' ? '' : '+';
  var key, keys, splitKeystroke;
  var keystrokes = keystroke.split(' ');
  var humanizedKeystrokes = [];
  for (var i = 0; i < keystrokes.length; i++) {
    var currentKeystroke = keystrokes[i];
    splitKeystroke = currentKeystroke.split('-');
    keys = [];
    for (var index = 0; index < splitKeystroke.length; index++) {
      key = splitKeystroke[index];
      if (key === '' && splitKeystroke[index - 1] === '') {
        key = '-';
      }
      if (key) {
        keys.push(humanizeKey(key, platform));
      }
    }
    keys = array.from(new Set(flatten(keys)));
    humanizedKeystrokes.push(keys.join(separator));
  }
  return humanizedKeystrokes.join(' ');
}

module.exports = {
  humanizeKeystroke: humanizeKeystroke
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBwZmw1Mm5wdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLWtleXN0cm9rZS1sYWJlbC9saWIva2V5c3Ryb2tlTGFiZWxIZWxwZXJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFdBQVcsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7ZUFlSSxPQUFPLENBQUMsaUJBQWlCLENBQUM7O0lBQW5DLEtBQUssWUFBTCxLQUFLOztBQUVaLElBQU0sbUJBQW1CLEdBQUc7QUFDMUIsS0FBRyxFQUFFLEdBQVE7QUFDYixLQUFHLEVBQUUsR0FBUTtBQUNiLE1BQUksRUFBRSxHQUFRO0FBQ2QsTUFBSSxFQUFFLEdBQVE7QUFDZCxPQUFLLEVBQUUsR0FBUTtBQUNmLE1BQUksRUFBRSxHQUFRO0FBQ2QsUUFBTSxFQUFFLEdBQVE7QUFDaEIsT0FBSyxFQUFFLEdBQVE7QUFDZixPQUFLLEVBQUUsR0FBUTtBQUNmLElBQUUsRUFBRSxHQUFRO0NBQ2IsQ0FBQzs7QUFFRixJQUFNLHVCQUF1QixHQUFHO0FBQzlCLEtBQUcsRUFBRSxLQUFLO0FBQ1YsS0FBRyxFQUFFLEtBQUs7QUFDVixNQUFJLEVBQUUsTUFBTTtBQUNaLE1BQUksRUFBRSxNQUFNO0FBQ1osT0FBSyxFQUFFLE9BQU87QUFDZCxNQUFJLEVBQUUsTUFBTTtBQUNaLFFBQU0sRUFBRSxLQUFLO0FBQ2IsT0FBSyxFQUFFLE9BQU87QUFDZCxPQUFLLEVBQUUsT0FBTztBQUNkLElBQUUsRUFBRSxJQUFJO0NBQ1QsQ0FBQzs7OztBQUlGLElBQU0sWUFBWSxHQUFHO0FBQ25CLEtBQUcsRUFBRSxHQUFHO0FBQ1IsS0FBRyxFQUFFLEdBQUc7QUFDUixLQUFHLEVBQUUsR0FBRztBQUNSLEtBQUcsRUFBRSxJQUFJO0FBQ1QsS0FBRyxFQUFFLEdBQUc7QUFDUixLQUFHLEVBQUUsR0FBRztBQUNSLEtBQUcsRUFBRSxHQUFHO0FBQ1IsS0FB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Q0FBQyxDQUFDLENBQUM7QUFDdkMsa0JBQWMsR0FBRyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDN0MsUUFBSSxHQUFHLEVBQUUsQ0FBQztBQUNWLFNBQUssSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFLEtBQUssR0FBRyxjQUFjLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFO0FBQzFELFNBQUcsR0FBRyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDNUIsVUFBSSxHQUFHLEtBQUssRUFBRSxJQUFJLGNBQWMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO0FBQ2xELFdBQUcsR0FBRyxHQUFHLENBQUM7T0FDWDtBQUNELFVBQUksR0FBRyxFQUFFO0FBQ1AsWUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7T0FDdkM7S0FDRjtBQUNELFFBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDMUMsdUJBQW1CLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztHQUNoRDtBQUNELFNBQU8sbUJBQW1CLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0NBQ3RDOztBQUVELE1BQU0sQ0FBQyxPQUFPLEdBQUc7QUFDZixtQkFBaUIsRUFBakIsaUJBQWlCO0NBQ2xCLENBQUMiLCJmaWxlIjoiL3Zhci9mb2xkZXJzL3hmL3JzcGg0X2M1NzMxNXJzNTd4eHNkc2tyeG52MzZ0MC9UL3RtcHBmbDUybnB1Ymxpc2hfcGFja2FnZXMvbnBtL251Y2xpZGUta2V5c3Ryb2tlLWxhYmVsL2xpYi9rZXlzdHJva2VMYWJlbEhlbHBlcnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJztcbi8qIEBmbG93ICovXG5cbi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgbGljZW5zZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGluXG4gKiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG4vKlxuICogYWRhcHRlZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9hdG9tL3VuZGVyc2NvcmUtcGx1cy9ibG9iL21hc3Rlci9zcmMvdW5kZXJzY29yZS1wbHVzLmNvZmZlZVxuICovXG5cbmNvbnN0IHthcnJheX0gPSByZXF1aXJlKCdudWNsaWRlLWNvbW1vbnMnKTtcblxuY29uc3QgTUFDX01PRElGSUVSX0tFWU1BUCA9IHtcbiAgYWx0OiAnXFx1MjMyNScsXG4gIGNtZDogJ1xcdTIzMTgnLFxuICBjdHJsOiAnXFx1MjMwMycsXG4gIGRvd246ICdcXHUyMTkzJyxcbiAgZW50ZXI6ICdcXHUyM2NlJyxcbiAgbGVmdDogJ1xcdTIxOTAnLFxuICBvcHRpb246ICdcXHUyMzI1JyxcbiAgcmlnaHQ6ICdcXHUyMTkyJyxcbiAgc2hpZnQ6ICdcXHUyMWU3JyxcbiAgdXA6ICdcXHUyMTkxJyxcbn07XG5cbmNvbnN0IE5PTl9NQUNfTU9ESUZJRVJfS0VZTUFQID0ge1xuICBhbHQ6ICdBbHQnLFxuICBjbWQ6ICdDbWQnLFxuICBjdHJsOiAnQ3RybCcsXG4gIGRvd246ICdEb3duJyxcbiAgZW50ZXI6ICdFbnRlcicsXG4gIGxlZnQ6ICdMZWZ0JyxcbiAgb3B0aW9uOiAnQWx0JyxcbiAgcmlnaHQ6ICdSaWdodCcsXG4gIHNoaWZ0OiAnU2hpZnQnLFxuICB1cDogJ1VwJyxcbn07XG5cbi8vIEh1bWFuIGtleSBjb21ib3Mgc2hvdWxkIGFsd2F5cyBleHBsaWNpdGx5IHN0YXRlIHRoZSBzaGlmdCBrZXkuIFRoaXMgbWFwIGlzIGEgZGlzYW1iaWd1YXRvci5cbi8vICdzaGlmdC12ZXJzaW9uJzogJ25vLXNoaWZ0LXZlcnNpb24nXG5jb25zdCBTSElGVF9LRVlNQVAgPSB7XG4gICdfJzogJy0nLFxuICAnOic6ICc7JyxcbiAgJz8nOiAnLycsXG4gICdcIic6ICdcXCcnLFxuICAneyc6ICdbJyxcbiAgJ30nOiAnXScsXG4gICcrJzogJz0nLFxuICAnPCc6ICcsJyxcbiAgJz4nOiAnLicsXG4gICd8JzogJ1xcXFwnLFxuICAnfic6ICdgJyxcbn07XG5cbmNvbnN0IEZOX0tFWV9SRSA9IC9mWzAtOV17MSwyfS87XG5cbi8vICRGbG93SXNzdWVcbmZ1bmN0aW9uIGZsYXR0ZW48VD4oYXJyOiBBcnJheTxUIHwgQXJyYXk8VD4+KTogQXJyYXk8VD4ge1xuICBsZXQgZmxhdHRlbmVkID0gW107XG4gIGZvciAoY29uc3QgZWwgb2YgYXJyKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZWwpKSB7XG4gICAgICBmbGF0dGVuZWQgPSBmbGF0dGVuZWQuY29uY2F0KGZsYXR0ZW4oZWwpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmxhdHRlbmVkLnB1c2goZWwpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmxhdHRlbmVkO1xufVxuXG5mdW5jdGlvbiBjYXBpdGFsaXplKHdvcmQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IGZpcnN0ID0gd29yZFswXSB8fCAnJztcbiAgY29uc3QgcmVzdCA9IHdvcmQuc2xpY2UoMSk7XG4gIHJldHVybiBmaXJzdC50b1VwcGVyQ2FzZSgpICsgcmVzdDtcbn1cblxuZnVuY3Rpb24gaHVtYW5pemVLZXkoa2V5OiBzdHJpbmcsIHBsYXRmb3JtOiA/c3RyaW5nKTogc3RyaW5nIHwgQXJyYXk8c3RyaW5nPiB7XG4gIGlmICgha2V5KSB7XG4gICAgcmV0dXJuIGtleTtcbiAgfVxuICBjb25zdCBtb2RpZmllcktleU1hcCA9IHBsYXRmb3JtID09PSAnZGFyd2luJyA/IE1BQ19NT0RJRklFUl9LRVlNQVAgOiBOT05fTUFDX01PRElGSUVSX0tFWU1BUDtcbiAgaWYgKG1vZGlmaWVyS2V5TWFwW2tleV0pIHtcbiAgICByZXR1cm4gbW9kaWZpZXJLZXlNYXBba2V5XTtcbiAgfVxuICBpZiAoa2V5Lmxlbmd0aCA9PT0gMSkge1xuICAgIGlmIChTSElGVF9LRVlNQVBba2V5XSkge1xuICAgICAgcmV0dXJuIFttb2RpZmllcktleU1hcC5zaGlmdCwgU0hJRlRfS0VZTUFQW2tleV1dO1xuICAgIH1cbiAgICBjb25zdCB1cHBlcmNhc2UgPSBrZXkudG9VcHBlckNhc2UoKTtcbiAgICBpZiAoa2V5ID09PSB1cHBlcmNhc2UgJiYgdXBwZXJjYXNlICE9PSBrZXkudG9Mb3dlckNhc2UoKSkge1xuICAgICAgcmV0dXJuIFttb2RpZmllcktleU1hcC5zaGlmdCwgdXBwZXJjYXNlXTtcbiAgICB9XG4gICAgcmV0dXJuIHVwcGVyY2FzZTtcbiAgfVxuICBpZiAoRk5fS0VZX1JFLnRlc3Qoa2V5KSkge1xuICAgIHJldHVybiBrZXkudG9VcHBlckNhc2UoKTtcbiAgfVxuICByZXR1cm4gcGxhdGZvcm0gPT09ICdkYXJ3aW4nID8ga2V5IDogY2FwaXRhbGl6ZShrZXkpO1xufVxuXG4vKiogSHVtYW5pemUgdGhlIGtleXN0cm9rZSBhY2NvcmRpbmcgdG8gcGxhdGZvcm0gY29udmVudGlvbnMuIFRoaXMgbWV0aG9kXG4gKiBhdHRlbXB0cyB0byBtaXJyb3IgdGhlIHRleHQgdGhlIGdpdmVuIGtleXN0cm9rZSB3b3VsZCBoYXZlIGlmIGRpc3BsYXllZCBpblxuICogYSBzeXN0ZW0gbWVudS5cbiAqXG4gKiBAcGFyYW0ga2V5c3Ryb2tlIEEgU3RyaW5nIGtleXN0cm9rZSB0byBodW1hbml6ZSBzdWNoIGFzIGBjdHJsLU9gLlxuICogQHBhcmFtIHBsYXRmb3JtIEFuIG9wdGlvbmFsIFN0cmluZyBwbGF0Zm9ybSB0byBodW1hbml6ZSBmb3IgKGRlZmF1bHQ6IGBwcm9jZXNzLnBsYXRmb3JtYCkuXG4gKiBAcmV0dXJuIGEgaHVtYW5pemVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBrZXlzdHJva2UuXG4gKi9cbmZ1bmN0aW9uIGh1bWFuaXplS2V5c3Ryb2tlKGtleXN0cm9rZTogc3RyaW5nLCBwbGF0Zm9ybTogP3N0cmluZyk6IHN0cmluZyB7XG4gIGlmICgha2V5c3Ryb2tlKSB7XG4gICAgcmV0dXJuIGtleXN0cm9rZTtcbiAgfVxuICBwbGF0Zm9ybSA9IHBsYXRmb3JtIHx8IHByb2Nlc3MucGxhdGZvcm07XG4gIGNvbnN0IHNlcGFyYXRvciA9IHBsYXRmb3JtID09PSAnZGFyd2luJyA/ICcnIDogJysnO1xuICB2YXIga2V5LCBrZXlzLCBzcGxpdEtleXN0cm9rZTtcbiAgY29uc3Qga2V5c3Ryb2tlcyA9IGtleXN0cm9rZS5zcGxpdCgnICcpO1xuICBjb25zdCBodW1hbml6ZWRLZXlzdHJva2VzID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwga2V5c3Ryb2tlcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGN1cnJlbnRLZXlzdHJva2UgPSBrZXlzdHJva2VzW2ldO1xuICAgIHNwbGl0S2V5c3Ryb2tlID0gY3VycmVudEtleXN0cm9rZS5zcGxpdCgnLScpO1xuICAgIGtleXMgPSBbXTtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgc3BsaXRLZXlzdHJva2UubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBrZXkgPSBzcGxpdEtleXN0cm9rZVtpbmRleF07XG4gICAgICBpZiAoa2V5ID09PSAnJyAmJiBzcGxpdEtleXN0cm9rZVtpbmRleCAtIDFdID09PSAnJykge1xuICAgICAgICBrZXkgPSAnLSc7XG4gICAgICB9XG4gICAgICBpZiAoa2V5KSB7XG4gICAgICAgIGtleXMucHVzaChodW1hbml6ZUtleShrZXksIHBsYXRmb3JtKSk7XG4gICAgICB9XG4gICAgfVxuICAgIGtleXMgPSBhcnJheS5mcm9tKG5ldyBTZXQoZmxhdHRlbihrZXlzKSkpO1xuICAgIGh1bWFuaXplZEtleXN0cm9rZXMucHVzaChrZXlzLmpvaW4oc2VwYXJhdG9yKSk7XG4gIH1cbiAgcmV0dXJuIGh1bWFuaXplZEtleXN0cm9rZXMuam9pbignICcpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgaHVtYW5pemVLZXlzdHJva2UsXG59O1xuIl19
