
/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

var _require = require('./utils');

var log = _require.log;

var _require2 = require('./ObjectId');

var remoteObjectIdOfObjectId = _require2.remoteObjectIdOfObjectId;
var endIndexOfObjectId = _require2.endIndexOfObjectId;
var startIndexOfObjectId = _require2.startIndexOfObjectId;
var countOfObjectId = _require2.countOfObjectId;
var getChildIds = _require2.getChildIds;

var _require3 = require('./values');

var convertValue = _require3.convertValue;

function convertProperties(id, properties) {
  log('Got properties: ' + JSON.stringify(properties));
  return properties.map(function (property) {
    return convertProperty(id, property);
  });
}

/**
 * Converts a DbgpProperty to a Chrome PropertyDescriptor.
 */
function convertProperty(contextId, dbgpProperty) {
  log('Converting to Chrome property: ' + JSON.stringify(dbgpProperty));
  var result = {
    configurable: false,
    enumerable: true,
    name: dbgpProperty.$.name,
    value: convertValue(contextId, dbgpProperty)
  };
  return result;
}

/**
 * Given an ObjectId for a multi page object, gets PropertyDescriptors
 * for the object's children.
 */
function getPagedProperties(pagedId) {
  var pagesize = pagedId.elementRange.pagesize;
  var endIndex = endIndexOfObjectId(pagedId);

  var childIds = getChildIds(pagedId);
  return childIds.map(function (childId) {
    var childStartIndex = startIndexOfObjectId(childId, pagesize);
    var childCount = countOfObjectId(childId, pagesize, endIndex);
    return {
      configurable: false,
      enumerable: true,
      name: 'Elements(' + childStartIndex + '..' + (childStartIndex + childCount - 1) + ')',
      value: {
        description: childCount + ' elements',
        type: 'object',
        objectId: remoteObjectIdOfObjectId(childId)
      }
    };
  });
}

module.exports = {
  convertProperties: convertProperties,
  convertProperty: convertProperty,
  getPagedProperties: getPagedProperties
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBwZmw1Mm5wdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLWRlYnVnZ2VyLWhodm0tcHJveHkvbGliL3Byb3BlcnRpZXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsV0FBVyxDQUFDOzs7Ozs7Ozs7O2VBWUUsT0FBTyxDQUFDLFNBQVMsQ0FBQzs7SUFBekIsR0FBRyxZQUFILEdBQUc7O2dCQU9OLE9BQU8sQ0FBQyxZQUFZLENBQUM7O0lBTHZCLHdCQUF3QixhQUF4Qix3QkFBd0I7SUFDeEIsa0JBQWtCLGFBQWxCLGtCQUFrQjtJQUNsQixvQkFBb0IsYUFBcEIsb0JBQW9CO0lBQ3BCLGVBQWUsYUFBZixlQUFlO0lBQ2YsV0FBVyxhQUFYLFdBQVc7O2dCQUdVLE9BQU8sQ0FBQyxVQUFVLENBQUM7O0lBQW5DLFlBQVksYUFBWixZQUFZOztBQUVuQixTQUFTLGlCQUFpQixDQUFDLEVBQVksRUFBRSxVQUErQixFQUE2QjtBQUNuRyxLQUFHLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO0FBQ3JELFNBQU8sVUFBVSxDQUFDLEdBQUcsQ0FBQyxVQUFBLFFBQVE7V0FBSSxlQUFlLENBQUMsRUFBRSxFQUFFLFFBQVEsQ0FBQztHQUFBLENBQUMsQ0FBQztDQUNsRTs7Ozs7QUFLRCxTQUFTLGVBQWUsQ0FBQyxTQUFtQixFQUFFLFlBQTBCLEVBQXNCO0FBQzVGLEtBQUcsQ0FBQyxpQ0FBaUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7QUFDdEUsTUFBTSxNQUFNLEdBQUc7QUFDYixnQkFBWSxFQUFFLEtBQUs7QUFDbkIsY0FBVSxFQUFFLElBQUk7QUFDaEIsUUFBSSxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSTtBQUN6QixTQUFLLEVBQUUsWUFBWSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUM7R0FDN0MsQ0FBQztBQUNGLFNBQU8sTUFBTSxDQUFDO0NBQ2Y7Ozs7OztBQU1ELFNBQVMsa0JBQWtCLENBQUMsT0FBaUIsRUFBNkI7QUFDeEUsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUM7QUFDL0MsTUFBTSxRQUFRLEdBQUcsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUM7O0FBRTdDLE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN0QyxTQUFPLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBQSxPQUFPLEVBQUk7QUFDN0IsUUFBTSxlQUFlLEdBQUcsb0JBQW9CLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQ2hFLFFBQU0sVUFBVSxHQUFHLGVBQWUsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQ2hFLFdBQU87QUFDTCxrQkFBWSxFQUFFLEtBQUs7QUFDbkIsZ0JBQVUsRUFBRSxJQUFJO0FBQ2hCLFVBQUksZ0JBQWMsZUFBZSxXQUFLLGVBQWUsR0FBRyxVQUFVLEdBQUcsQ0FBQyxDQUFBLE1BQUc7QUFDekUsV0FBSyxFQUFFO0FBQ0wsbUJBQVcsRUFBSyxVQUFVLGNBQVc7QUFDckMsWUFBSSxFQUFFLFFBQVE7QUFDZCxnQkFBUSxFQUFFLHdCQUF3QixDQUFDLE9BQU8sQ0FBQztPQUM1QztLQUNGLENBQUM7R0FDSCxDQUFDLENBQUM7Q0FDSjs7QUFFRCxNQUFNLENBQUMsT0FBTyxHQUFHO0FBQ2YsbUJBQWlCLEVBQWpCLGlCQUFpQjtBQUNqQixpQkFBZSxFQUFmLGVBQWU7QUFDZixvQkFBa0IsRUFBbEIsa0JBQWtCO0NBQ25CLENBQUMiLCJmaWxlIjoiL3Zhci9mb2xkZXJzL3hmL3JzcGg0X2M1NzMxNXJzNTd4eHNkc2tyeG52MzZ0MC9UL3RtcHBmbDUybnB1Ymxpc2hfcGFja2FnZXMvbnBtL251Y2xpZGUtZGVidWdnZXItaGh2bS1wcm94eS9saWIvcHJvcGVydGllcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuLyogQGZsb3cgKi9cblxuLypcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBsaWNlbnNlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgaW5cbiAqIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cblxuY29uc3Qge2xvZ30gPSByZXF1aXJlKCcuL3V0aWxzJyk7XG5jb25zdCB7XG4gIHJlbW90ZU9iamVjdElkT2ZPYmplY3RJZCxcbiAgZW5kSW5kZXhPZk9iamVjdElkLFxuICBzdGFydEluZGV4T2ZPYmplY3RJZCxcbiAgY291bnRPZk9iamVjdElkLFxuICBnZXRDaGlsZElkcyxcbn0gPSByZXF1aXJlKCcuL09iamVjdElkJyk7XG5cbmNvbnN0IHtjb252ZXJ0VmFsdWV9ID0gcmVxdWlyZSgnLi92YWx1ZXMnKTtcblxuZnVuY3Rpb24gY29udmVydFByb3BlcnRpZXMoaWQ6IE9iamVjdElkLCBwcm9wZXJ0aWVzOiBBcnJheTxEYmdwUHJvcGVydHk+KTogQXJyYXk8UHJvcGVydHlEZXNjcmlwdG9yPiB7XG4gIGxvZygnR290IHByb3BlcnRpZXM6ICcgKyBKU09OLnN0cmluZ2lmeShwcm9wZXJ0aWVzKSk7XG4gIHJldHVybiBwcm9wZXJ0aWVzLm1hcChwcm9wZXJ0eSA9PiBjb252ZXJ0UHJvcGVydHkoaWQsIHByb3BlcnR5KSk7XG59XG5cbi8qKlxuICogQ29udmVydHMgYSBEYmdwUHJvcGVydHkgdG8gYSBDaHJvbWUgUHJvcGVydHlEZXNjcmlwdG9yLlxuICovXG5mdW5jdGlvbiBjb252ZXJ0UHJvcGVydHkoY29udGV4dElkOiBPYmplY3RJZCwgZGJncFByb3BlcnR5OiBEYmdwUHJvcGVydHkpOiBQcm9wZXJ0eURlc2NyaXB0b3Ige1xuICBsb2coJ0NvbnZlcnRpbmcgdG8gQ2hyb21lIHByb3BlcnR5OiAnICsgSlNPTi5zdHJpbmdpZnkoZGJncFByb3BlcnR5KSk7XG4gIGNvbnN0IHJlc3VsdCA9IHtcbiAgICBjb25maWd1cmFibGU6IGZhbHNlLFxuICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgbmFtZTogZGJncFByb3BlcnR5LiQubmFtZSxcbiAgICB2YWx1ZTogY29udmVydFZhbHVlKGNvbnRleHRJZCwgZGJncFByb3BlcnR5KSxcbiAgfTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBHaXZlbiBhbiBPYmplY3RJZCBmb3IgYSBtdWx0aSBwYWdlIG9iamVjdCwgZ2V0cyBQcm9wZXJ0eURlc2NyaXB0b3JzXG4gKiBmb3IgdGhlIG9iamVjdCdzIGNoaWxkcmVuLlxuICovXG5mdW5jdGlvbiBnZXRQYWdlZFByb3BlcnRpZXMocGFnZWRJZDogT2JqZWN0SWQpOiBBcnJheTxQcm9wZXJ0eURlc2NyaXB0b3I+IHtcbiAgY29uc3QgcGFnZXNpemUgPSBwYWdlZElkLmVsZW1lbnRSYW5nZS5wYWdlc2l6ZTtcbiAgY29uc3QgZW5kSW5kZXggPSBlbmRJbmRleE9mT2JqZWN0SWQocGFnZWRJZCk7XG5cbiAgY29uc3QgY2hpbGRJZHMgPSBnZXRDaGlsZElkcyhwYWdlZElkKTtcbiAgcmV0dXJuIGNoaWxkSWRzLm1hcChjaGlsZElkID0+IHtcbiAgICBjb25zdCBjaGlsZFN0YXJ0SW5kZXggPSBzdGFydEluZGV4T2ZPYmplY3RJZChjaGlsZElkLCBwYWdlc2l6ZSk7XG4gICAgY29uc3QgY2hpbGRDb3VudCA9IGNvdW50T2ZPYmplY3RJZChjaGlsZElkLCBwYWdlc2l6ZSwgZW5kSW5kZXgpO1xuICAgIHJldHVybiB7XG4gICAgICBjb25maWd1cmFibGU6IGZhbHNlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIG5hbWU6IGBFbGVtZW50cygke2NoaWxkU3RhcnRJbmRleH0uLiR7Y2hpbGRTdGFydEluZGV4ICsgY2hpbGRDb3VudCAtIDF9KWAsXG4gICAgICB2YWx1ZToge1xuICAgICAgICBkZXNjcmlwdGlvbjogYCR7Y2hpbGRDb3VudH0gZWxlbWVudHNgLFxuICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgb2JqZWN0SWQ6IHJlbW90ZU9iamVjdElkT2ZPYmplY3RJZChjaGlsZElkKSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjb252ZXJ0UHJvcGVydGllcyxcbiAgY29udmVydFByb3BlcnR5LFxuICBnZXRQYWdlZFByb3BlcnRpZXMsXG59O1xuIl19
