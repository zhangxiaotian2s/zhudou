
/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

/**
 * This code implements the NuclideFs client.  It uses the request module to
 * make XHR requests to the NuclideFS service.  It is a Promise based API.
 */

var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var NuclideClient = (function () {
  function NuclideClient(id, eventbus) {
    var options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

    _classCallCheck(this, NuclideClient);

    this._id = id;
    this.eventbus = eventbus;
    this._options = options;
    this._searchProviders = {};
  }

  _createClass(NuclideClient, [{
    key: 'getID',
    value: function getID() {
      return this._id;
    }

    // Resolves if the connection looks healthy.
    // Will reject quickly if the connection looks unhealthy.
  }, {
    key: 'testConnection',
    value: function testConnection() {
      return this.eventbus.testConnection();
    }

    // Delegate RPC functions to the NuclideRemoteEventbus class.
  }, {
    key: 'callRemoteFunction',
    value: function callRemoteFunction() {
      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      return this.eventbus.callRemoteFunction.apply(this.eventbus, args);
    }
  }, {
    key: 'createRemoteObject',
    value: function createRemoteObject() {
      for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        args[_key2] = arguments[_key2];
      }

      return this.eventbus.createRemoteObject.apply(this.eventbus, args);
    }
  }, {
    key: 'callRemoteMethod',
    value: function callRemoteMethod() {
      for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
        args[_key3] = arguments[_key3];
      }

      return this.eventbus.callRemoteMethod.apply(this.eventbus, args);
    }
  }, {
    key: 'disposeRemoteObject',
    value: function disposeRemoteObject() {
      for (var _len4 = arguments.length, args = Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
        args[_key4] = arguments[_key4];
      }

      return this.eventbus.disposeRemoteObject.apply(this.eventbus, args);
    }

    // Delegate marshalling to the NuclideRemoteEventbus class.
  }, {
    key: 'marshal',
    value: function marshal() {
      var _eventbus;

      return (_eventbus = this.eventbus).marshal.apply(_eventbus, arguments);
    }
  }, {
    key: 'unmarshal',
    value: function unmarshal() {
      var _eventbus2;

      return (_eventbus2 = this.eventbus).unmarshal.apply(_eventbus2, arguments);
    }
  }, {
    key: 'registerType',
    value: function registerType() {
      var _eventbus3;

      return (_eventbus3 = this.eventbus).registerType.apply(_eventbus3, arguments);
    }

    /**
     * Make rpc call to service given serviceUri in form of `$serviceName/$methodName` and args as arguments list.
     */
  }, {
    key: 'makeRpc',
    value: function makeRpc(serviceUri, args, serviceOptions) {
      var _serviceUri$split = serviceUri.split('/');

      var _serviceUri$split2 = _slicedToArray(_serviceUri$split, 2);

      var serviceName = _serviceUri$split2[0];
      var methodName = _serviceUri$split2[1];

      return this.eventbus.callServiceFrameworkMethod(serviceName, methodName,
      /* methodArgs */args,
      /* serviceOptions */serviceOptions);
    }
  }, {
    key: 'registerEventListener',
    value: function registerEventListener(eventName, callback, serviceOptions) {
      return this.eventbus.registerEventListener(eventName, callback, serviceOptions);
    }

    /**
     * Searches the contents of `directory` for paths mathing `query`.
     */
  }, {
    key: 'searchDirectory',
    value: _asyncToGenerator(function* (directory, query) {
      return yield this.eventbus.callMethod(
      /*serviceName*/'search',
      /*methodName*/'directory',
      /*methodArgs*/[directory, query],
      /*extraOptions*/{ json: true });
    })
  }, {
    key: 'doSearchQuery',
    value: function doSearchQuery(rootDirectory, provider, query) {
      return this.eventbus.callMethod(
      /*serviceName*/'search',
      /*methodName*/'query',
      /*methodArgs*/[rootDirectory, provider, query],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'getSearchProviders',
    value: _asyncToGenerator(function* (rootDirectory) {
      var providers = this._searchProviders[rootDirectory];
      if (providers) {
        return providers;
      }
      providers = yield this.eventbus.callMethod(
      /*serviceName*/'search',
      /*methodName*/'listProviders',
      /*methodArgs*/[rootDirectory],
      /*extraOptions*/{ method: 'POST', json: true });

      this._searchProviders[rootDirectory] = providers;

      return providers;
    })
  }, {
    key: 'close',
    value: function close() {
      if (this.eventbus) {
        this.eventbus.close();
        this.eventbus = null;
      }
    }
  }]);

  return NuclideClient;
})();

module.exports = NuclideClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBwZmw1Mm5wdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLXNlcnZlci9saWIvTnVjbGlkZUNsaWVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxXQUFXLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBcUJOLGFBQWE7QUFLTixXQUxQLGFBQWEsQ0FLTCxFQUFVLEVBQUUsUUFBeUIsRUFBdUM7UUFBckMsT0FBOEIseURBQUcsRUFBRTs7MEJBTGxGLGFBQWE7O0FBTWYsUUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUM7QUFDZCxRQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztBQUN6QixRQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQztBQUN4QixRQUFJLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO0dBQzVCOztlQVZHLGFBQWE7O1dBWVosaUJBQUc7QUFDTixhQUFPLElBQUksQ0FBQyxHQUFHLENBQUM7S0FDakI7Ozs7OztXQUlhLDBCQUFrQjtBQUM5QixhQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFLENBQUM7S0FDdkM7Ozs7O1dBR2lCLDhCQUEyQjt3Q0FBdkIsSUFBSTtBQUFKLFlBQUk7OztBQUN4QixhQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUM7S0FDcEU7OztXQUNpQiw4QkFBdUM7eUNBQW5DLElBQUk7QUFBSixZQUFJOzs7QUFDeEIsYUFBTyxJQUFJLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO0tBQ3BFOzs7V0FDZSw0QkFBMkI7eUNBQXZCLElBQUk7QUFBSixZQUFJOzs7QUFDdEIsYUFBTyxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO0tBQ2xFOzs7V0FDa0IsK0JBQXFDO3lDQUFqQyxJQUFJO0FBQUosWUFBSTs7O0FBQ3pCLGFBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztLQUNyRTs7Ozs7V0FHTSxtQkFBZTs7O0FBQ3BCLGFBQU8sYUFBQSxJQUFJLENBQUMsUUFBUSxFQUFDLE9BQU8sTUFBQSxzQkFBUyxDQUFDO0tBQ3ZDOzs7V0FDUSxxQkFBZTs7O0FBQ3RCLGFBQU8sY0FBQSxJQUFJLENBQUMsUUFBUSxFQUFDLFNBQVMsTUFBQSx1QkFBUyxDQUFDO0tBQ3pDOzs7V0FDVyx3QkFBZ0I7OztBQUMxQixhQUFPLGNBQUEsSUFBSSxDQUFDLFFBQVEsRUFBQyxZQUFZLE1BQUEsdUJBQVMsQ0FBQztLQUM1Qzs7Ozs7OztXQUtNLGlCQUFDLFVBQWtCLEVBQUUsSUFBZ0IsRUFBRSxjQUFtQixFQUFnQjs4QkFDN0MsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7Ozs7VUFBaEQsV0FBVztVQUFFLFVBQVU7O0FBQzlCLGFBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQywwQkFBMEIsQ0FDN0MsV0FBVyxFQUNYLFVBQVU7c0JBQ08sSUFBSTswQkFDQSxjQUFjLENBQ3JDLENBQUM7S0FDRjs7O1dBRW9CLCtCQUFDLFNBQWlCLEVBQUUsUUFBdUMsRUFBRSxjQUFtQixFQUFjO0FBQ2pILGFBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxTQUFTLEVBQUUsUUFBUSxFQUFFLGNBQWMsQ0FBQyxDQUFDO0tBQ2pGOzs7Ozs7OzZCQUtvQixXQUFDLFNBQWlCLEVBQUUsS0FBYSxFQUFnQjtBQUNwRSxhQUFPLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVO3FCQUNuQixRQUFRO29CQUNULFdBQVc7b0JBQ1gsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDO3NCQUNoQixFQUFDLElBQUksRUFBRSxJQUFJLEVBQUMsQ0FDOUIsQ0FBQztLQUNIOzs7V0FFWSx1QkFBQyxhQUFvQixFQUFFLFFBQWdCLEVBQUUsS0FBYSxFQUFXO0FBQzVFLGFBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVO3FCQUNiLFFBQVE7b0JBQ1QsT0FBTztvQkFDUCxDQUFDLGFBQWEsRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDO3NCQUM5QixFQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQyxDQUM5QyxDQUFDO0tBQ0g7Ozs2QkFFdUIsV0FBQyxhQUFxQixFQUFpQztBQUM3RSxVQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDckQsVUFBSSxTQUFTLEVBQUU7QUFDYixlQUFPLFNBQVMsQ0FBQztPQUNsQjtBQUNELGVBQVMsR0FBRyxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVTtxQkFDeEIsUUFBUTtvQkFDVCxlQUFlO29CQUNmLENBQUMsYUFBYSxDQUFDO3NCQUNiLEVBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQzlDLENBQUM7O0FBRUYsVUFBSSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxHQUFHLFNBQVMsQ0FBQzs7QUFFakQsYUFBTyxTQUFTLENBQUM7S0FDbEI7OztXQUVJLGlCQUFVO0FBQ2IsVUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO0FBQ2pCLFlBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDdEIsWUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7T0FDdEI7S0FDRjs7O1NBM0dHLGFBQWE7OztBQThHbkIsTUFBTSxDQUFDLE9BQU8sR0FBRyxhQUFhLENBQUMiLCJmaWxlIjoiL3Zhci9mb2xkZXJzL3hmL3JzcGg0X2M1NzMxNXJzNTd4eHNkc2tyeG52MzZ0MC9UL3RtcHBmbDUybnB1Ymxpc2hfcGFja2FnZXMvbnBtL251Y2xpZGUtc2VydmVyL2xpYi9OdWNsaWRlQ2xpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG4vKiBAZmxvdyAqL1xuXG4vKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIGxpY2Vuc2UgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpblxuICogdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNvZGUgaW1wbGVtZW50cyB0aGUgTnVjbGlkZUZzIGNsaWVudC4gIEl0IHVzZXMgdGhlIHJlcXVlc3QgbW9kdWxlIHRvXG4gKiBtYWtlIFhIUiByZXF1ZXN0cyB0byB0aGUgTnVjbGlkZUZTIHNlcnZpY2UuICBJdCBpcyBhIFByb21pc2UgYmFzZWQgQVBJLlxuICovXG5cbnR5cGUgRXhlY1Jlc3VsdCA9IHtlcnJvcjogP0Vycm9yOyBzdGRvdXQ6IHN0cmluZzsgc3RkZXJyOiBzdHJpbmd9O1xudHlwZSBOdWNsaWRlQ2xpZW50T3B0aW9ucyA9IHtcbiAgY3dkOiA/c3RyaW5nO1xufTtcblxuY2xhc3MgTnVjbGlkZUNsaWVudCB7XG4gIF9pZDogc3RyaW5nO1xuICBfb3B0aW9uczogTnVjbGlkZUNsaWVudE9wdGlvbnM7XG4gIGV2ZW50YnVzOiBOdWNsaWRlRXZlbnRidXM7XG5cbiAgY29uc3RydWN0b3IoaWQ6IHN0cmluZywgZXZlbnRidXM6IE51Y2xpZGVFdmVudGJ1cywgb3B0aW9uczogP051Y2xpZGVDbGllbnRPcHRpb25zID0ge30pIHtcbiAgICB0aGlzLl9pZCA9IGlkO1xuICAgIHRoaXMuZXZlbnRidXMgPSBldmVudGJ1cztcbiAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcbiAgICB0aGlzLl9zZWFyY2hQcm92aWRlcnMgPSB7fTtcbiAgfVxuXG4gIGdldElEKCkge1xuICAgIHJldHVybiB0aGlzLl9pZDtcbiAgfVxuXG4gIC8vIFJlc29sdmVzIGlmIHRoZSBjb25uZWN0aW9uIGxvb2tzIGhlYWx0aHkuXG4gIC8vIFdpbGwgcmVqZWN0IHF1aWNrbHkgaWYgdGhlIGNvbm5lY3Rpb24gbG9va3MgdW5oZWFsdGh5LlxuICB0ZXN0Q29ubmVjdGlvbigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5ldmVudGJ1cy50ZXN0Q29ubmVjdGlvbigpO1xuICB9XG5cbiAgLy8gRGVsZWdhdGUgUlBDIGZ1bmN0aW9ucyB0byB0aGUgTnVjbGlkZVJlbW90ZUV2ZW50YnVzIGNsYXNzLlxuICBjYWxsUmVtb3RlRnVuY3Rpb24oLi4uYXJnczogQXJyYXk8YW55Pik6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMuY2FsbFJlbW90ZUZ1bmN0aW9uLmFwcGx5KHRoaXMuZXZlbnRidXMsIGFyZ3MpO1xuICB9XG4gIGNyZWF0ZVJlbW90ZU9iamVjdCguLi5hcmdzOiBBcnJheTxhbnk+KTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICByZXR1cm4gdGhpcy5ldmVudGJ1cy5jcmVhdGVSZW1vdGVPYmplY3QuYXBwbHkodGhpcy5ldmVudGJ1cywgYXJncyk7XG4gIH1cbiAgY2FsbFJlbW90ZU1ldGhvZCguLi5hcmdzOiBBcnJheTxhbnk+KTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5ldmVudGJ1cy5jYWxsUmVtb3RlTWV0aG9kLmFwcGx5KHRoaXMuZXZlbnRidXMsIGFyZ3MpO1xuICB9XG4gIGRpc3Bvc2VSZW1vdGVPYmplY3QoLi4uYXJnczogQXJyYXk8YW55Pik6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmRpc3Bvc2VSZW1vdGVPYmplY3QuYXBwbHkodGhpcy5ldmVudGJ1cywgYXJncyk7XG4gIH1cblxuICAvLyBEZWxlZ2F0ZSBtYXJzaGFsbGluZyB0byB0aGUgTnVjbGlkZVJlbW90ZUV2ZW50YnVzIGNsYXNzLlxuICBtYXJzaGFsKC4uLmFyZ3MpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLm1hcnNoYWwoLi4uYXJncyk7XG4gIH1cbiAgdW5tYXJzaGFsKC4uLmFyZ3MpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLnVubWFyc2hhbCguLi5hcmdzKTtcbiAgfVxuICByZWdpc3RlclR5cGUoLi4uYXJncyk6IHZvaWQge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLnJlZ2lzdGVyVHlwZSguLi5hcmdzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYWtlIHJwYyBjYWxsIHRvIHNlcnZpY2UgZ2l2ZW4gc2VydmljZVVyaSBpbiBmb3JtIG9mIGAkc2VydmljZU5hbWUvJG1ldGhvZE5hbWVgIGFuZCBhcmdzIGFzIGFyZ3VtZW50cyBsaXN0LlxuICAgKi9cbiAgbWFrZVJwYyhzZXJ2aWNlVXJpOiBzdHJpbmcsIGFyZ3M6IEFycmF5PGFueT4sIHNlcnZpY2VPcHRpb25zOiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgIGNvbnN0IFtzZXJ2aWNlTmFtZSwgbWV0aG9kTmFtZV0gPSBzZXJ2aWNlVXJpLnNwbGl0KCcvJyk7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMuY2FsbFNlcnZpY2VGcmFtZXdvcmtNZXRob2QoXG4gICAgICBzZXJ2aWNlTmFtZSxcbiAgICAgIG1ldGhvZE5hbWUsXG4gICAgICAvKiBtZXRob2RBcmdzICovIGFyZ3MsXG4gICAgICAvKiBzZXJ2aWNlT3B0aW9ucyAqLyBzZXJ2aWNlT3B0aW9uc1xuICAgKTtcbiAgfVxuXG4gIHJlZ2lzdGVyRXZlbnRMaXN0ZW5lcihldmVudE5hbWU6IHN0cmluZywgY2FsbGJhY2s6ICguLi5hcmdzOiBBcnJheTxhbnk+KSA9PiB2b2lkLCBzZXJ2aWNlT3B0aW9uczogYW55KTogRGlzcG9zYWJsZSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMucmVnaXN0ZXJFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgY2FsbGJhY2ssIHNlcnZpY2VPcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWFyY2hlcyB0aGUgY29udGVudHMgb2YgYGRpcmVjdG9yeWAgZm9yIHBhdGhzIG1hdGhpbmcgYHF1ZXJ5YC5cbiAgICovXG4gIGFzeW5jIHNlYXJjaERpcmVjdG9yeShkaXJlY3Rvcnk6IHN0cmluZywgcXVlcnk6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnc2VhcmNoJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICdkaXJlY3RvcnknLFxuICAgICAgLyptZXRob2RBcmdzKi8gW2RpcmVjdG9yeSwgcXVlcnldLFxuICAgICAgLypleHRyYU9wdGlvbnMqLyB7anNvbjogdHJ1ZX1cbiAgICApO1xuICB9XG5cbiAgZG9TZWFyY2hRdWVyeShyb290RGlyZWN0b3J5OnN0cmluZywgcHJvdmlkZXI6IHN0cmluZywgcXVlcnk6IHN0cmluZyk6IFByb21pc2Uge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ3NlYXJjaCcsXG4gICAgICAvKm1ldGhvZE5hbWUqLyAncXVlcnknLFxuICAgICAgLyptZXRob2RBcmdzKi8gW3Jvb3REaXJlY3RvcnksIHByb3ZpZGVyLCBxdWVyeV0sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHttZXRob2Q6ICdQT1NUJywganNvbjogdHJ1ZX1cbiAgICApO1xuICB9XG5cbiAgYXN5bmMgZ2V0U2VhcmNoUHJvdmlkZXJzKHJvb3REaXJlY3Rvcnk6IHN0cmluZyk6IFByb21pc2U8QXJyYXk8e25hbWU6c3RyaW5nfT4+IHtcbiAgICBsZXQgcHJvdmlkZXJzID0gdGhpcy5fc2VhcmNoUHJvdmlkZXJzW3Jvb3REaXJlY3RvcnldO1xuICAgIGlmIChwcm92aWRlcnMpIHtcbiAgICAgIHJldHVybiBwcm92aWRlcnM7XG4gICAgfVxuICAgIHByb3ZpZGVycyA9IGF3YWl0IHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnc2VhcmNoJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICdsaXN0UHJvdmlkZXJzJyxcbiAgICAgIC8qbWV0aG9kQXJncyovIFtyb290RGlyZWN0b3J5XSxcbiAgICAgIC8qZXh0cmFPcHRpb25zKi8ge21ldGhvZDogJ1BPU1QnLCBqc29uOiB0cnVlfVxuICAgICk7XG5cbiAgICB0aGlzLl9zZWFyY2hQcm92aWRlcnNbcm9vdERpcmVjdG9yeV0gPSBwcm92aWRlcnM7XG5cbiAgICByZXR1cm4gcHJvdmlkZXJzO1xuICB9XG5cbiAgY2xvc2UoKSA6IHZvaWQge1xuICAgIGlmICh0aGlzLmV2ZW50YnVzKSB7XG4gICAgICB0aGlzLmV2ZW50YnVzLmNsb3NlKCk7XG4gICAgICB0aGlzLmV2ZW50YnVzID0gbnVsbDtcbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBOdWNsaWRlQ2xpZW50O1xuIl19
