Object.defineProperty(exports, '__esModule', {
  value: true
});

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

var _utils = require('./utils');

var _helpers = require('./helpers');

var _Handler2 = require('./Handler');

var _Handler3 = _interopRequireDefault(_Handler2);

var _DbgpSocket = require('./DbgpSocket');

'use babel';

var SESSION_END_EVENT = 'session-end-event';

// Handles all 'Debug.*' Chrome dev tools messages

var DebuggerHandler = (function (_Handler) {
  _inherits(DebuggerHandler, _Handler);

  function DebuggerHandler(clientCallback, connectionMultiplexer) {
    _classCallCheck(this, DebuggerHandler);

    _get(Object.getPrototypeOf(DebuggerHandler.prototype), 'constructor', this).call(this, 'Debugger', clientCallback);

    this._hadFirstContinuationCommand = false;
    this._connectionMultiplexer = connectionMultiplexer;
    var FileCache = require('./FileCache');
    this._files = new FileCache(clientCallback);

    var _require = require('events');

    var EventEmitter = _require.EventEmitter;

    this._emitter = new EventEmitter();
    this._statusSubscription = this._connectionMultiplexer.onStatus(this._onStatusChanged.bind(this));
  }

  _createClass(DebuggerHandler, [{
    key: 'onSessionEnd',
    value: function onSessionEnd(callback) {
      (0, _utils.log)('onSessionEnd');
      this._emitter.on(SESSION_END_EVENT, callback);
    }
  }, {
    key: 'handleMethod',
    value: _asyncToGenerator(function* (id, method, params) {

      switch (method) {

        // TODO: Add Console (aka logging) support
        case 'enable':
          this._debuggerEnable(id);
          break;

        case 'pause':
          yield this._sendBreakCommand(id);
          break;

        case 'stepInto':
          this._sendContinuationCommand(_DbgpSocket.COMMAND_STEP_INTO);
          break;

        case 'stepOut':
          this._sendContinuationCommand(_DbgpSocket.COMMAND_STEP_OUT);
          break;

        case 'stepOver':
          this._sendContinuationCommand(_DbgpSocket.COMMAND_STEP_OVER);
          break;

        case 'resume':
          this._sendContinuationCommand(_DbgpSocket.COMMAND_RUN);
          break;

        case 'setPauseOnExceptions':
          yield this._setPauseOnExceptions(id, params);
          break;

        case 'setAsyncCallStackDepth':
        case 'skipStackFrames':
          this.replyWithError(id, 'Not implemented');
          break;

        case 'getScriptSource':
          // TODO: Handle file read errors.
          // TODO: Handle non-file scriptIds
          this.replyToCommand(id, { scriptSource: yield this._files.getFileSource(params.scriptId) });
          break;

        case 'setBreakpointByUrl':
          this._setBreakpointByUrl(id, params);
          break;

        case 'removeBreakpoint':
          yield this._removeBreakpoint(id, params);
          break;

        case 'evaluateOnCallFrame':
          var result = yield this._connectionMultiplexer.evaluateOnCallFrame(Number(params.callFrameId), params.expression);
          this.replyToCommand(id, result);
          break;

        default:
          this.unknownMethod(id, method, params);
          break;
      }
    })
  }, {
    key: '_setPauseOnExceptions',
    value: _asyncToGenerator(function* (id, params) {
      var state = params.state;

      yield this._connectionMultiplexer.setPauseOnExceptions(state);
      this.replyToCommand(id, {});
    })
  }, {
    key: '_setBreakpointByUrl',
    value: function _setBreakpointByUrl(id, params) {
      var lineNumber = params.lineNumber;
      var url = params.url;
      var columnNumber = params.columnNumber;
      var condition = params.condition;

      if (!url || condition !== '' || columnNumber !== 0) {
        this.replyWithError(id, 'Invalid arguments to Debugger.setBreakpointByUrl: ' + JSON.stringify(params));
        return;
      }
      this._files.registerFile(url);

      var path = (0, _helpers.uriToPath)(url);
      var breakpointId = this._connectionMultiplexer.setBreakpoint(path, lineNumber + 1);
      this.replyToCommand(id, {
        breakpointId: breakpointId,
        locations: [{
          lineNumber: lineNumber,
          scriptId: path
        }] });
    }
  }, {
    key: '_removeBreakpoint',
    value: _asyncToGenerator(function* (id, params) {
      var breakpointId = params.breakpointId;

      yield this._connectionMultiplexer.removeBreakpoint(breakpointId);
      this.replyToCommand(id, { id: breakpointId });
    })
  }, {
    key: '_debuggerEnable',
    value: function _debuggerEnable(id) {
      this.replyToCommand(id, {});
      this._sendFakeLoaderBreakpoint();
    }
  }, {
    key: '_getStackFrames',
    value: _asyncToGenerator(function* () {
      var _this = this;

      var frames = yield this._connectionMultiplexer.getStackFrames();
      return yield Promise.all(frames.stack.map(function (frame, frameIndex) {
        return _this._convertFrame(frame, frameIndex);
      }));
    })
  }, {
    key: '_convertFrame',
    value: _asyncToGenerator(function* (frame, frameIndex) {
      (0, _utils.log)('Converting frame: ' + JSON.stringify(frame));

      var _require2 = require('./frame');

      var idOfFrame = _require2.idOfFrame;
      var functionOfFrame = _require2.functionOfFrame;
      var fileUrlOfFrame = _require2.fileUrlOfFrame;
      var locationOfFrame = _require2.locationOfFrame;

      this._files.registerFile(fileUrlOfFrame(frame));
      return {
        callFrameId: idOfFrame(frame),
        functionName: functionOfFrame(frame),
        location: locationOfFrame(frame),
        scopeChain: yield this._connectionMultiplexer.getScopesForFrame(frameIndex)
      };
    })

    // Returns one of:
    //  starting, stopping, stopped, running, break
  }, {
    key: '_getStatus',
    value: function _getStatus() {
      return this._connectionMultiplexer.getStatus();
    }
  }, {
    key: '_sendContinuationCommand',
    value: function _sendContinuationCommand(command) {
      if (!this._hadFirstContinuationCommand) {
        this._hadFirstContinuationCommand = true;
        this.sendMethod('Debugger.resumed');
        this._connectionMultiplexer.listen();
        return;
      }
      (0, _utils.log)('Sending continuation command: ' + command);
      this._connectionMultiplexer.sendContinuationCommand(command);
    }
  }, {
    key: '_sendBreakCommand',
    value: _asyncToGenerator(function* (id) {
      var response = yield this._connectionMultiplexer.sendBreakCommand();
      if (!response) {
        this.replyWithError(id, 'Unable to break');
      }
    })
  }, {
    key: '_onStatusChanged',
    value: _asyncToGenerator(function* (status) {
      (0, _utils.log)('Sending status: ' + status);
      switch (status) {
        case _DbgpSocket.STATUS_BREAK:
          yield this._sendPausedMessage();
          break;
        case _DbgpSocket.STATUS_RUNNING:
          this.sendMethod('Debugger.resumed');
          break;
        case _DbgpSocket.STATUS_STOPPED:
        case _DbgpSocket.STATUS_ERROR:
        case _DbgpSocket.STATUS_END:
          this._endSession();
          break;
        case _DbgpSocket.STATUS_STARTING:
        case _DbgpSocket.STATUS_STOPPING:
          // These two should be hidden by the ConnectionMultiplexer
          break;
        default:
          (0, _utils.logErrorAndThrow)('Unexpected status: ' + status);
      }
    })

    // May only call when in paused state.
  }, {
    key: '_sendPausedMessage',
    value: _asyncToGenerator(function* () {
      this.sendMethod('Debugger.paused', {
        callFrames: yield this._getStackFrames(),
        reason: 'breakpoint', // TODO: better reason?
        data: {}
      });
    })
  }, {
    key: '_sendFakeLoaderBreakpoint',
    value: function _sendFakeLoaderBreakpoint() {
      this.sendMethod('Debugger.paused', {
        callFrames: [],
        reason: 'breakpoint', // TODO: better reason?
        data: {}
      });
    }
  }, {
    key: '_endSession',
    value: function _endSession() {
      (0, _utils.log)('DebuggerHandler: Ending session');
      if (this._statusSubscription) {
        this._statusSubscription.dispose();
        this._statusSubscription = null;
      }
      this._emitter.emit(SESSION_END_EVENT);
    }
  }]);

  return DebuggerHandler;
})(_Handler3['default']);

exports.DebuggerHandler = DebuggerHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBwZmw1Mm5wdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLWRlYnVnZ2VyLWhodm0tcHJveHkvbGliL0RlYnVnZ2VySGFuZGxlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7cUJBWW9DLFNBQVM7O3VCQUNyQixXQUFXOzt3QkFDZixXQUFXOzs7OzBCQWF4QixjQUFjOztBQTNCckIsV0FBVyxDQUFDOztBQWtDWixJQUFNLGlCQUFpQixHQUFHLG1CQUFtQixDQUFDOzs7O0lBR2pDLGVBQWU7WUFBZixlQUFlOztBQU9mLFdBUEEsZUFBZSxDQVF4QixjQUE4QixFQUM5QixxQkFBNEMsRUFDNUM7MEJBVlMsZUFBZTs7QUFXeEIsK0JBWFMsZUFBZSw2Q0FXbEIsVUFBVSxFQUFFLGNBQWMsRUFBRTs7QUFFbEMsUUFBSSxDQUFDLDRCQUE0QixHQUFHLEtBQUssQ0FBQztBQUMxQyxRQUFJLENBQUMsc0JBQXNCLEdBQUcscUJBQXFCLENBQUM7QUFDcEQsUUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ3pDLFFBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUM7O21CQUNyQixPQUFPLENBQUMsUUFBUSxDQUFDOztRQUFqQyxZQUFZLFlBQVosWUFBWTs7QUFDbkIsUUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0FBQ25DLFFBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUM3RCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUNqQyxDQUFDO0dBQ0g7O2VBdEJVLGVBQWU7O1dBd0JkLHNCQUFDLFFBQW9CLEVBQVE7QUFDdkMsaUJBbERJLEdBQUcsRUFrREgsY0FBYyxD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LEVBQUU7QUFDeEMsY0FBTSxFQUFFLFlBQVk7QUFDcEIsWUFBSSxFQUFFLEVBQUU7T0FDVCxDQUFDLENBQUM7S0FDTjs7O1dBRXdCLHFDQUFTO0FBQ2hDLFVBQUksQ0FBQyxVQUFVLENBQ2IsaUJBQWlCLEVBQ2pCO0FBQ0Usa0JBQVUsRUFBRSxFQUFFO0FBQ2QsY0FBTSxFQUFFLFlBQVk7QUFDcEIsWUFBSSxFQUFFLEVBQUU7T0FDVCxDQUFDLENBQUM7S0FDTjs7O1dBRVUsdUJBQVM7QUFDbEIsaUJBMVBJLEdBQUcsRUEwUEgsaUNBQWlDLENBQUMsQ0FBQztBQUN2QyxVQUFJLElBQUksQ0FBQyxtQkFBbUIsRUFBRTtBQUM1QixZQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDbkMsWUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQztPQUNqQztBQUNELFVBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7S0FDdkM7OztTQXZPVSxlQUFlIiwiZmlsZSI6Ii92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBwZmw1Mm5wdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLWRlYnVnZ2VyLWhodm0tcHJveHkvbGliL0RlYnVnZ2VySGFuZGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuLyogQGZsb3cgKi9cblxuLypcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBsaWNlbnNlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgaW5cbiAqIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cblxuaW1wb3J0IHtsb2csIGxvZ0Vycm9yQW5kVGhyb3d9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHt1cmlUb1BhdGh9IGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgSGFuZGxlciBmcm9tICcuL0hhbmRsZXInO1xuaW1wb3J0IHtcbiAgU1RBVFVTX1NUQVJUSU5HLFxuICBTVEFUVVNfU1RPUFBJTkcsXG4gIFNUQVRVU19TVE9QUEVELFxuICBTVEFUVVNfUlVOTklORyxcbiAgU1RBVFVTX0JSRUFLLFxuICBTVEFUVVNfRVJST1IsXG4gIFNUQVRVU19FTkQsXG4gIENPTU1BTkRfUlVOLFxuICBDT01NQU5EX1NURVBfSU5UTyxcbiAgQ09NTUFORF9TVEVQX09WRVIsXG4gIENPTU1BTkRfU1RFUF9PVVQsXG59IGZyb20gJy4vRGJncFNvY2tldCc7XG5cbmltcG9ydCB0eXBlIHtDb25uZWN0aW9uTXVsdGlwbGV4ZXJ9IGZyb20gJy4vQ29ubmVjdGlvbk11bHRpcGxleGVyJztcbmltcG9ydCB0eXBlIHtDbGllbnRDYWxsYmFja30gZnJvbSAnLi9DbGllbnRDYWxsYmFjayc7XG5pbXBvcnQgdHlwZSBGaWxlQ2FjaGUgZnJvbSAnLi9GaWxlQ2FjaGUnO1xuaW1wb3J0IHR5cGUge0V2ZW50RW1pdHRlcn0gZnJvbSAnZXZlbnRzJztcblxuY29uc3QgU0VTU0lPTl9FTkRfRVZFTlQgPSAnc2Vzc2lvbi1lbmQtZXZlbnQnO1xuXG4vLyBIYW5kbGVzIGFsbCAnRGVidWcuKicgQ2hyb21lIGRldiB0b29scyBtZXNzYWdlc1xuZXhwb3J0IGNsYXNzIERlYnVnZ2VySGFuZGxlciBleHRlbmRzIEhhbmRsZXIge1xuICBfY29ubmVjdGlvbk11bHRpcGxleGVyOiBDb25uZWN0aW9uTXVsdGlwbGV4ZXI7XG4gIF9maWxlczogRmlsZUNhY2hlO1xuICBfZW1pdHRlcjogRXZlbnRFbWl0dGVyO1xuICBfc3RhdHVzU3Vic2NyaXB0aW9uOiA/RGlzcG9zYWJsZTtcbiAgX2hhZEZpcnN0Q29udGludWF0aW9uQ29tbWFuZDogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBjbGllbnRDYWxsYmFjazogQ2xpZW50Q2FsbGJhY2ssXG4gICAgY29ubmVjdGlvbk11bHRpcGxleGVyOiBDb25uZWN0aW9uTXVsdGlwbGV4ZXJcbiAgKSB7XG4gICAgc3VwZXIoJ0RlYnVnZ2VyJywgY2xpZW50Q2FsbGJhY2spO1xuXG4gICAgdGhpcy5faGFkRmlyc3RDb250aW51YXRpb25Db21tYW5kID0gZmFsc2U7XG4gICAgdGhpcy5fY29ubmVjdGlvbk11bHRpcGxleGVyID0gY29ubmVjdGlvbk11bHRpcGxleGVyO1xuICAgIGNvbnN0IEZpbGVDYWNoZSA9IHJlcXVpcmUoJy4vRmlsZUNhY2hlJyk7XG4gICAgdGhpcy5fZmlsZXMgPSBuZXcgRmlsZUNhY2hlKGNsaWVudENhbGxiYWNrKTtcbiAgICBjb25zdCB7RXZlbnRFbWl0dGVyfSA9IHJlcXVpcmUoJ2V2ZW50cycpO1xuICAgIHRoaXMuX2VtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgdGhpcy5fc3RhdHVzU3Vic2NyaXB0aW9uID0gdGhpcy5fY29ubmVjdGlvbk11bHRpcGxleGVyLm9uU3RhdHVzKFxuICAgICAgdGhpcy5fb25TdGF0dXNDaGFuZ2VkLmJpbmQodGhpcylcbiAgICApO1xuICB9XG5cbiAgb25TZXNzaW9uRW5kKGNhbGxiYWNrOiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgbG9nKCdvblNlc3Npb25FbmQnKTtcbiAgICB0aGlzLl9lbWl0dGVyLm9uKFNFU1NJT05fRU5EX0VWRU5ULCBjYWxsYmFjayk7XG4gIH1cblxuICBhc3luYyBoYW5kbGVNZXRob2QoaWQ6IG51bWJlciwgbWV0aG9kOiBzdHJpbmcsIHBhcmFtczogT2JqZWN0KTogUHJvbWlzZSB7XG5cbiAgICBzd2l0Y2ggKG1ldGhvZCkge1xuXG4gICAgICAvLyBUT0RPOiBBZGQgQ29uc29sZSAoYWthIGxvZ2dpbmcpIHN1cHBvcnRcbiAgICAgIGNhc2UgJ2VuYWJsZSc6XG4gICAgICAgIHRoaXMuX2RlYnVnZ2VyRW5hYmxlKGlkKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ3BhdXNlJzpcbiAgICAgICAgYXdhaXQgdGhpcy5fc2VuZEJyZWFrQ29tbWFuZChpZCk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdzdGVwSW50byc6XG4gICAgICAgIHRoaXMuX3NlbmRDb250aW51YXRpb25Db21tYW5kKENPTU1BTkRfU1RFUF9JTlRPKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ3N0ZXBPdXQnOlxuICAgICAgICB0aGlzLl9zZW5kQ29udGludWF0aW9uQ29tbWFuZChDT01NQU5EX1NURVBfT1VUKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ3N0ZXBPdmVyJzpcbiAgICAgICAgdGhpcy5fc2VuZENvbnRpbnVhdGlvbkNvbW1hbmQoQ09NTUFORF9TVEVQX09WRVIpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAncmVzdW1lJzpcbiAgICAgICAgdGhpcy5fc2VuZENvbnRpbnVhdGlvbkNvbW1hbmQoQ09NTUFORF9SVU4pO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnc2V0UGF1c2VPbkV4Y2VwdGlvbnMnOlxuICAgICAgICBhd2FpdCB0aGlzLl9zZXRQYXVzZU9uRXhjZXB0aW9ucyhpZCwgcGFyYW1zKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ3NldEFzeW5jQ2FsbFN0YWNrRGVwdGgnOlxuICAgICAgY2FzZSAnc2tpcFN0YWNrRnJhbWVzJzpcbiAgICAgICAgdGhpcy5yZXBseVdpdGhFcnJvcihpZCwgJ05vdCBpbXBsZW1lbnRlZCcpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnZ2V0U2NyaXB0U291cmNlJzpcbiAgICAgICAgLy8gVE9ETzogSGFuZGxlIGZpbGUgcmVhZCBlcnJvcnMuXG4gICAgICAgIC8vIFRPRE86IEhhbmRsZSBub24tZmlsZSBzY3JpcHRJZHNcbiAgICAgICAgdGhpcy5yZXBseVRvQ29tbWFuZChpZCwgeyBzY3JpcHRTb3VyY2U6IGF3YWl0IHRoaXMuX2ZpbGVzLmdldEZpbGVTb3VyY2UocGFyYW1zLnNjcmlwdElkKSB9KTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ3NldEJyZWFrcG9pbnRCeVVybCc6XG4gICAgICAgIHRoaXMuX3NldEJyZWFrcG9pbnRCeVVybChpZCwgcGFyYW1zKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ3JlbW92ZUJyZWFrcG9pbnQnOlxuICAgICAgICBhd2FpdCB0aGlzLl9yZW1vdmVCcmVha3BvaW50KGlkLCBwYXJhbXMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnZXZhbHVhdGVPbkNhbGxGcmFtZSc6XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuX2Nvbm5lY3Rpb25NdWx0aXBsZXhlci5ldmFsdWF0ZU9uQ2FsbEZyYW1lKFxuICAgICAgICAgIE51bWJlcihwYXJhbXMuY2FsbEZyYW1lSWQpLFxuICAgICAgICAgIHBhcmFtcy5leHByZXNzaW9uXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMucmVwbHlUb0NvbW1hbmQoaWQsIHJlc3VsdCk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aGlzLnVua25vd25NZXRob2QoaWQsIG1ldGhvZCwgcGFyYW1zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgX3NldFBhdXNlT25FeGNlcHRpb25zKGlkOiBudW1iZXIsIHBhcmFtczogT2JqZWN0KTogUHJvbWlzZSB7XG4gICAgY29uc3Qge3N0YXRlfSA9IHBhcmFtcztcbiAgICBhd2FpdCB0aGlzLl9jb25uZWN0aW9uTXVsdGlwbGV4ZXIuc2V0UGF1c2VPbkV4Y2VwdGlvbnMoc3RhdGUpO1xuICAgIHRoaXMucmVwbHlUb0NvbW1hbmQoaWQsIHt9KTtcbiAgfVxuXG4gIF9zZXRCcmVha3BvaW50QnlVcmwoaWQ6IG51bWJlciwgcGFyYW1zOiBPYmplY3QpOiB2b2lkIHtcbiAgICBjb25zdCB7bGluZU51bWJlciwgdXJsLCBjb2x1bW5OdW1iZXIsIGNvbmRpdGlvbn0gPSBwYXJhbXM7XG4gICAgaWYgKCF1cmwgfHwgY29uZGl0aW9uICE9PSAnJyB8fCBjb2x1bW5OdW1iZXIgIT09IDApIHtcbiAgICAgIHRoaXMucmVwbHlXaXRoRXJyb3IoaWQsICdJbnZhbGlkIGFyZ3VtZW50cyB0byBEZWJ1Z2dlci5zZXRCcmVha3BvaW50QnlVcmw6ICcgKyBKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fZmlsZXMucmVnaXN0ZXJGaWxlKHVybCk7XG5cbiAgICBjb25zdCBwYXRoID0gdXJpVG9QYXRoKHVybCk7XG4gICAgY29uc3QgYnJlYWtwb2ludElkID0gdGhpcy5fY29ubmVjdGlvbk11bHRpcGxleGVyLnNldEJyZWFrcG9pbnQocGF0aCwgbGluZU51bWJlciArIDEpO1xuICAgIHRoaXMucmVwbHlUb0NvbW1hbmQoaWQsIHtcbiAgICAgIGJyZWFrcG9pbnRJZDogYnJlYWtwb2ludElkLFxuICAgICAgbG9jYXRpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBsaW5lTnVtYmVyLFxuICAgICAgICAgIHNjcmlwdElkOiBwYXRoLFxuICAgICAgICB9LFxuICAgICAgXX0pO1xuICB9XG5cbiAgYXN5bmMgX3JlbW92ZUJyZWFrcG9pbnQoaWQ6IG51bWJlciwgcGFyYW1zOiBPYmplY3QpOiBQcm9taXNlIHtcbiAgICBjb25zdCB7YnJlYWtwb2ludElkfSA9IHBhcmFtcztcbiAgICBhd2FpdCB0aGlzLl9jb25uZWN0aW9uTXVsdGlwbGV4ZXIucmVtb3ZlQnJlYWtwb2ludChicmVha3BvaW50SWQpO1xuICAgIHRoaXMucmVwbHlUb0NvbW1hbmQoaWQsIHtpZDogYnJlYWtwb2ludElkfSk7XG4gIH1cblxuICBfZGVidWdnZXJFbmFibGUoaWQ6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMucmVwbHlUb0NvbW1hbmQoaWQsIHt9KTtcbiAgICB0aGlzLl9zZW5kRmFrZUxvYWRlckJyZWFrcG9pbnQoKTtcbiAgfVxuXG4gIGFzeW5jIF9nZXRTdGFja0ZyYW1lcygpOiBQcm9taXNlPEFycmF5PE9iamVjdD4+IHtcbiAgICBjb25zdCBmcmFtZXMgPSBhd2FpdCB0aGlzLl9jb25uZWN0aW9uTXVsdGlwbGV4ZXIuZ2V0U3RhY2tGcmFtZXMoKTtcbiAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBmcmFtZXMuc3RhY2subWFwKChmcmFtZSwgZnJhbWVJbmRleCkgPT4gdGhpcy5fY29udmVydEZyYW1lKGZyYW1lLCBmcmFtZUluZGV4KSkpO1xuICB9XG5cbiAgYXN5bmMgX2NvbnZlcnRGcmFtZShmcmFtZTogT2JqZWN0LCBmcmFtZUluZGV4OiBudW1iZXIpOiBQcm9taXNlPE9iamVjdD4ge1xuICAgIGxvZygnQ29udmVydGluZyBmcmFtZTogJyArIEpTT04uc3RyaW5naWZ5KGZyYW1lKSk7XG4gICAgY29uc3Qge1xuICAgICAgaWRPZkZyYW1lLFxuICAgICAgZnVuY3Rpb25PZkZyYW1lLFxuICAgICAgZmlsZVVybE9mRnJhbWUsXG4gICAgICBsb2NhdGlvbk9mRnJhbWUsXG4gICAgfSA9IHJlcXVpcmUoJy4vZnJhbWUnKTtcblxuICAgIHRoaXMuX2ZpbGVzLnJlZ2lzdGVyRmlsZShmaWxlVXJsT2ZGcmFtZShmcmFtZSkpO1xuICAgIHJldHVybiB7XG4gICAgICBjYWxsRnJhbWVJZDogaWRPZkZyYW1lKGZyYW1lKSxcbiAgICAgIGZ1bmN0aW9uTmFtZTogZnVuY3Rpb25PZkZyYW1lKGZyYW1lKSxcbiAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbk9mRnJhbWUoZnJhbWUpLFxuICAgICAgc2NvcGVDaGFpbjogYXdhaXQgdGhpcy5fY29ubmVjdGlvbk11bHRpcGxleGVyLmdldFNjb3Blc0ZvckZyYW1lKGZyYW1lSW5kZXgpLFxuICAgIH07XG4gIH1cblxuICAvLyBSZXR1cm5zIG9uZSBvZjpcbiAgLy8gIHN0YXJ0aW5nLCBzdG9wcGluZywgc3RvcHBlZCwgcnVubmluZywgYnJlYWtcbiAgX2dldFN0YXR1cygpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uTXVsdGlwbGV4ZXIuZ2V0U3RhdHVzKCk7XG4gIH1cblxuICBfc2VuZENvbnRpbnVhdGlvbkNvbW1hbmQoY29tbWFuZDogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLl9oYWRGaXJzdENvbnRpbnVhdGlvbkNvbW1hbmQpIHtcbiAgICAgIHRoaXMuX2hhZEZpcnN0Q29udGludWF0aW9uQ29tbWFuZCA9IHRydWU7XG4gICAgICB0aGlzLnNlbmRNZXRob2QoJ0RlYnVnZ2VyLnJlc3VtZWQnKTtcbiAgICAgIHRoaXMuX2Nvbm5lY3Rpb25NdWx0aXBsZXhlci5saXN0ZW4oKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbG9nKCdTZW5kaW5nIGNvbnRpbnVhdGlvbiBjb21tYW5kOiAnICsgY29tbWFuZCk7XG4gICAgdGhpcy5fY29ubmVjdGlvbk11bHRpcGxleGVyLnNlbmRDb250aW51YXRpb25Db21tYW5kKGNvbW1hbmQpO1xuICB9XG5cbiAgYXN5bmMgX3NlbmRCcmVha0NvbW1hbmQoaWQ6IG51bWJlcik6IFByb21pc2Uge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5fY29ubmVjdGlvbk11bHRpcGxleGVyLnNlbmRCcmVha0NvbW1hbmQoKTtcbiAgICBpZiAoIXJlc3BvbnNlKSB7XG4gICAgICB0aGlzLnJlcGx5V2l0aEVycm9yKGlkLCAnVW5hYmxlIHRvIGJyZWFrJyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgX29uU3RhdHVzQ2hhbmdlZChzdGF0dXM6IHN0cmluZyk6IFByb21pc2Uge1xuICAgIGxvZygnU2VuZGluZyBzdGF0dXM6ICcgKyBzdGF0dXMpO1xuICAgIHN3aXRjaCAoc3RhdHVzKSB7XG4gICAgICBjYXNlIFNUQVRVU19CUkVBSzpcbiAgICAgICAgYXdhaXQgdGhpcy5fc2VuZFBhdXNlZE1lc3NhZ2UoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFNUQVRVU19SVU5OSU5HOlxuICAgICAgICB0aGlzLnNlbmRNZXRob2QoJ0RlYnVnZ2VyLnJlc3VtZWQnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFNUQVRVU19TVE9QUEVEOlxuICAgICAgY2FzZSBTVEFUVVNfRVJST1I6XG4gICAgICBjYXNlIFNUQVRVU19FTkQ6XG4gICAgICAgIHRoaXMuX2VuZFNlc3Npb24oKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFNUQVRVU19TVEFSVElORzpcbiAgICAgIGNhc2UgU1RBVFVTX1NUT1BQSU5HOlxuICAgICAgICAvLyBUaGVzZSB0d28gc2hvdWxkIGJlIGhpZGRlbiBieSB0aGUgQ29ubmVjdGlvbk11bHRpcGxleGVyXG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbG9nRXJyb3JBbmRUaHJvdygnVW5leHBlY3RlZCBzdGF0dXM6ICcgKyBzdGF0dXMpO1xuICAgIH1cbiAgfVxuXG4gIC8vIE1heSBvbmx5IGNhbGwgd2hlbiBpbiBwYXVzZWQgc3RhdGUuXG4gIGFzeW5jIF9zZW5kUGF1c2VkTWVzc2FnZSgpOiBQcm9taXNlIHtcbiAgICB0aGlzLnNlbmRNZXRob2QoXG4gICAgICAnRGVidWdnZXIucGF1c2VkJyxcbiAgICAgIHtcbiAgICAgICAgY2FsbEZyYW1lczogYXdhaXQgdGhpcy5fZ2V0U3RhY2tGcmFtZXMoKSxcbiAgICAgICAgcmVhc29uOiAnYnJlYWtwb2ludCcsIC8vIFRPRE86IGJldHRlciByZWFzb24/XG4gICAgICAgIGRhdGE6IHt9LFxuICAgICAgfSk7XG4gIH1cblxuICBfc2VuZEZha2VMb2FkZXJCcmVha3BvaW50KCk6IHZvaWQge1xuICAgIHRoaXMuc2VuZE1ldGhvZChcbiAgICAgICdEZWJ1Z2dlci5wYXVzZWQnLFxuICAgICAge1xuICAgICAgICBjYWxsRnJhbWVzOiBbXSxcbiAgICAgICAgcmVhc29uOiAnYnJlYWtwb2ludCcsIC8vIFRPRE86IGJldHRlciByZWFzb24/XG4gICAgICAgIGRhdGE6IHt9LFxuICAgICAgfSk7XG4gIH1cblxuICBfZW5kU2Vzc2lvbigpOiB2b2lkIHtcbiAgICBsb2coJ0RlYnVnZ2VySGFuZGxlcjogRW5kaW5nIHNlc3Npb24nKTtcbiAgICBpZiAodGhpcy5fc3RhdHVzU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLl9zdGF0dXNTdWJzY3JpcHRpb24uZGlzcG9zZSgpO1xuICAgICAgdGhpcy5fc3RhdHVzU3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgICB9XG4gICAgdGhpcy5fZW1pdHRlci5lbWl0KFNFU1NJT05fRU5EX0VWRU5UKTtcbiAgfVxufVxuIl19
