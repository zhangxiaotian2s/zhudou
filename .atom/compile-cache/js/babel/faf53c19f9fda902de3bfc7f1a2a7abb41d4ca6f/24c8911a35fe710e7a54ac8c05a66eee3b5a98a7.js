'use babel';

/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var _require = require('atom');

var Range = _require.Range;

var testPath = 'myPath';

describe('FlowDiagnosticsProvider', function () {

  var flowDiagnosticsProvider = undefined;

  beforeEach(function () {
    var FakeProviderBase = function FakeProviderBase() {
      _classCallCheck(this, FakeProviderBase);
    };

    var FlowDiagnosticsProvider = require('../lib/FlowDiagnosticsProvider');
    flowDiagnosticsProvider = new FlowDiagnosticsProvider(false, FakeProviderBase);
  });

  describe('processDiagnostics', function () {
    it('should propertly transform a simple diagnostic', function () {
      var diags = [[{
        level: 'error',
        path: testPath,
        descr: 'message',
        line: 1,
        endline: 2,
        start: 3,
        end: 4,
        code: 0
      }]];

      var expectedOutput = {
        scope: 'file',
        providerName: 'Flow',
        text: 'message',
        type: 'Error',
        filePath: testPath,
        range: new Range([0, 2], [1, 4])
      };

      var message = flowDiagnosticsProvider._processDiagnostics(diags, testPath).filePathToMessages.get(testPath)[0];
      expect(message).toEqual(expectedOutput);
    });

    it('should invalidate errors from the current file if Flow returns none', function () {
      var diags = [];
      var update = flowDiagnosticsProvider._processDiagnostics(diags, testPath);
      expect(update.filePathToMessages.has(testPath)).toBe(true);
    });

    it('should keep warnings as warnings', function () {
      var diags = [[{
        level: 'warning',
        path: testPath,
        descr: 'message',
        line: 1,
        endline: 2,
        start: 3,
        end: 4,
        code: 0
      }]];

      var expectedOutput = {
        scope: 'file',
        providerName: 'Flow',
        text: 'message',
        type: 'Warning',
        filePath: testPath,
        range: new Range([0, 2], [1, 4])
      };

      var message = flowDiagnosticsProvider._processDiagnostics(diags, testPath).filePathToMessages.get(testPath)[0];
      expect(message).toEqual(expectedOutput);
    });

    it('should not filter diagnostics not in the target file', function () {
      var diags = [[{
        path: 'notMyPath',
        descr: 'message',
        line: 1,
        endline: 2,
        start: 3,
        end: 4,
        code: 0
      }]];

      var allMessages = flowDiagnosticsProvider._processDiagnostics(diags, testPath).filePathToMessages;
      expect(allMessages.has('notMyPath')).toBe(true);
    });

    it('should create traces for diagnostics spanning multiple messages', function () {
      var diags = [[{
        level: 'error',
        path: testPath,
        descr: 'message',
        line: 1,
        endline: 2,
        start: 3,
        end: 4,
        code: 0
      }, {
        level: 'error',
        path: 'otherPath',
        descr: 'more message',
        line: 5,
        endline: 6,
        start: 7,
        end: 8,
        code: 0
      }]];

      var expectedOutput = {
        scope: 'file',
        providerName: 'Flow',
        type: 'Error',
        text: 'message',
        filePath: testPath,
        range: new Range([0, 2], [1, 4]),
        trace: [{
          type: 'Trace',
          filePath: 'otherPath',
          text: 'more message',
          range: new Range([4, 6], [5, 8])
        }]
      };

      var message = flowDiagnosticsProvider._processDiagnostics(diags, testPath).filePathToMessages.get(testPath)[0];
      expect(message).toEqual(expectedOutput);
    });
  });

  describe('invalidateProjectPath', function () {
    it('should remove corresponding errors to certain flow root', function () {
      // Mock a diagnostic provider with 2 flow roots, sharing common file real paths.
      var flowRootToFilePaths = new Map();
      var root1Paths = ['/flow/root1/file.js', '/flow/common/file.js'];
      var root2Paths = ['/flow/root2/file.js', '/flow/common/file.js'];
      flowRootToFilePaths.set('/flow/root1', new Set(root1Paths));
      flowRootToFilePaths.set('/flow/root2', new Set(root2Paths));
      flowDiagnosticsProvider._flowRootToFilePaths = flowRootToFilePaths;
      // Mock the `publishMessageInvalidation` call to capture call arguments.
      var publishHandler = jasmine.createSpy('publish');
      flowDiagnosticsProvider._providerBase.publishMessageInvalidation = publishHandler;

      flowDiagnosticsProvider.invalidateProjectPath('/flow/root1');
      expect(publishHandler.callCount).toBe(1);
      expect(publishHandler.argsForCall[0][0]).toEqual({ scope: 'file', filePaths: root1Paths });
      expect(flowDiagnosticsProvider._flowRootToFilePaths.size).toBe(1);
      expect(flowDiagnosticsProvider._flowRootToFilePaths.get('/flow/root2')).toEqual(new Set(root2Paths));
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy96aGFuZ3hpYW90aWFuLy5hdG9tL3BhY2thZ2VzL251Y2xpZGUtZmxvdy9zcGVjL0Zsb3dEaWFnbm9zdGljc1Byb3ZpZGVyLXNwZWMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsV0FBVyxDQUFDOzs7Ozs7Ozs7Ozs7ZUFXSSxPQUFPLENBQUMsTUFBTSxDQUFDOztJQUF4QixLQUFLLFlBQUwsS0FBSzs7QUFFWixJQUFNLFFBQVEsR0FBRyxRQUFRLENBQUM7O0FBRTFCLFFBQVEsQ0FBQyx5QkFBeUIsRUFBRSxZQUFNOztBQUV4QyxNQUFJLHVCQUE0QixZQUFBLENBQUM7O0FBRWpDLFlBQVUsQ0FBQyxZQUFNO1FBQ1QsZ0JBQWdCLFlBQWhCLGdCQUFnQjs0QkFBaEIsZ0JBQWdCOzs7QUFDdEIsUUFBTSx1QkFBdUIsR0FBRyxPQUFPLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztBQUMxRSwyQkFBdUIsR0FBRyxJQUFJLHVCQUF1QixDQUFDLEtBQUssRUFBRyxnQkFBZ0IsQ0FBTyxDQUFDO0dBQ3ZGLENBQUMsQ0FBQzs7QUFFSCxVQUFRLENBQUMsb0JBQW9CLEVBQUUsWUFBTTtBQUNuQyxNQUFFLENBQUMsZ0RBQWdELEVBQUUsWUFBTTtBQUN6RCxVQUFNLEtBQUssR0FBRyxDQUFDLENBQ2I7QUFDRSxhQUFLLEVBQUUsT0FBTztBQUNkLFlBQUksRUFBRSxRQUFRO0FBQ2QsYUFBSyxFQUFFLFNBQVM7QUFDaEIsWUFBSSxFQUFFLENBQUM7QUFDUCxlQUFPLEVBQUUsQ0FBQztBQUNWLGFBQUssRUFBRSxDQUFDO0FBQ1IsV0FBRyxFQUFFLENBQUM7QUFDTixZQUFJLEVBQUUsQ0FBQztPQUNSLENBQ0YsQ0FBQyxDQUFDOztBQUVILFVBQU0sY0FBYyxHQUFHO0FBQ3JCLGFBQUssRUFBRSxNQUFNO0FBQ2Isb0JBQVksRUFBRSxNQUFNO0FBQ3BCLFlBQUksRUFBRSxTQUFTO0FBQ2YsWUFBSSxFQUFFLE9BQU87QUFDYixnQkFBUSxFQUFFLFFBQVE7QUFD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QyxDQUFDLENBQUM7S0FDakMsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBRUosQ0FBQyxDQUFDIiwiZmlsZSI6Ii9Vc2Vycy96aGFuZ3hpYW90aWFuLy5hdG9tL3BhY2thZ2VzL251Y2xpZGUtZmxvdy9zcGVjL0Zsb3dEaWFnbm9zdGljc1Byb3ZpZGVyLXNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJztcbi8qIEBmbG93ICovXG5cbi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgbGljZW5zZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGluXG4gKiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG5jb25zdCB7UmFuZ2V9ID0gcmVxdWlyZSgnYXRvbScpO1xuXG5jb25zdCB0ZXN0UGF0aCA9ICdteVBhdGgnO1xuXG5kZXNjcmliZSgnRmxvd0RpYWdub3N0aWNzUHJvdmlkZXInLCAoKSA9PiB7XG5cbiAgbGV0IGZsb3dEaWFnbm9zdGljc1Byb3ZpZGVyOiBhbnk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgY2xhc3MgRmFrZVByb3ZpZGVyQmFzZSB7IH1cbiAgICBjb25zdCBGbG93RGlhZ25vc3RpY3NQcm92aWRlciA9IHJlcXVpcmUoJy4uL2xpYi9GbG93RGlhZ25vc3RpY3NQcm92aWRlcicpO1xuICAgIGZsb3dEaWFnbm9zdGljc1Byb3ZpZGVyID0gbmV3IEZsb3dEaWFnbm9zdGljc1Byb3ZpZGVyKGZhbHNlLCAoRmFrZVByb3ZpZGVyQmFzZTogYW55KSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwcm9jZXNzRGlhZ25vc3RpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcm9wZXJ0bHkgdHJhbnNmb3JtIGEgc2ltcGxlIGRpYWdub3N0aWMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkaWFncyA9IFtbXG4gICAgICAgIHtcbiAgICAgICAgICBsZXZlbDogJ2Vycm9yJyxcbiAgICAgICAgICBwYXRoOiB0ZXN0UGF0aCxcbiAgICAgICAgICBkZXNjcjogJ21lc3NhZ2UnLFxuICAgICAgICAgIGxpbmU6IDEsXG4gICAgICAgICAgZW5kbGluZTogMixcbiAgICAgICAgICBzdGFydDogMyxcbiAgICAgICAgICBlbmQ6IDQsXG4gICAgICAgICAgY29kZTogMCxcbiAgICAgICAgfSxcbiAgICAgIF1dO1xuXG4gICAgICBjb25zdCBleHBlY3RlZE91dHB1dCA9IHtcbiAgICAgICAgc2NvcGU6ICdmaWxlJyxcbiAgICAgICAgcHJvdmlkZXJOYW1lOiAnRmxvdycsXG4gICAgICAgIHRleHQ6ICdtZXNzYWdlJyxcbiAgICAgICAgdHlwZTogJ0Vycm9yJyxcbiAgICAgICAgZmlsZVBhdGg6IHRlc3RQYXRoLFxuICAgICAgICByYW5nZTogbmV3IFJhbmdlKFswLCAyXSwgWzEsIDRdKSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBmbG93RGlhZ25vc3RpY3NQcm92aWRlclxuICAgICAgICAuX3Byb2Nlc3NEaWFnbm9zdGljcyhkaWFncywgdGVzdFBhdGgpXG4gICAgICAgIC5maWxlUGF0aFRvTWVzc2FnZXMuZ2V0KHRlc3RQYXRoKVswXTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0VxdWFsKGV4cGVjdGVkT3V0cHV0KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW52YWxpZGF0ZSBlcnJvcnMgZnJvbSB0aGUgY3VycmVudCBmaWxlIGlmIEZsb3cgcmV0dXJucyBub25lJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGlhZ3MgPSBbXTtcbiAgICAgIGNvbnN0IHVwZGF0ZSA9IGZsb3dEaWFnbm9zdGljc1Byb3ZpZGVyLl9wcm9jZXNzRGlhZ25vc3RpY3MoZGlhZ3MsIHRlc3RQYXRoKTtcbiAgICAgIGV4cGVjdCh1cGRhdGUuZmlsZVBhdGhUb01lc3NhZ2VzLmhhcyh0ZXN0UGF0aCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGtlZXAgd2FybmluZ3MgYXMgd2FybmluZ3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkaWFncyA9IFtbXG4gICAgICAgIHtcbiAgICAgICAgICBsZXZlbDogJ3dhcm5pbmcnLFxuICAgICAgICAgIHBhdGg6IHRlc3RQYXRoLFxuICAgICAgICAgIGRlc2NyOiAnbWVzc2FnZScsXG4gICAgICAgICAgbGluZTogMSxcbiAgICAgICAgICBlbmRsaW5lOiAyLFxuICAgICAgICAgIHN0YXJ0OiAzLFxuICAgICAgICAgIGVuZDogNCxcbiAgICAgICAgICBjb2RlOiAwLFxuICAgICAgICB9LFxuICAgICAgXV07XG5cbiAgICAgIGNvbnN0IGV4cGVjdGVkT3V0cHV0ID0ge1xuICAgICAgICBzY29wZTogJ2ZpbGUnLFxuICAgICAgICBwcm92aWRlck5hbWU6ICdGbG93JyxcbiAgICAgICAgdGV4dDogJ21lc3NhZ2UnLFxuICAgICAgICB0eXBlOiAnV2FybmluZycsXG4gICAgICAgIGZpbGVQYXRoOiB0ZXN0UGF0aCxcbiAgICAgICAgcmFuZ2U6IG5ldyBSYW5nZShbMCwgMl0sIFsxLCA0XSksXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtZXNzYWdlID0gZmxvd0RpYWdub3N0aWNzUHJvdmlkZXJcbiAgICAgICAgLl9wcm9jZXNzRGlhZ25vc3RpY3MoZGlhZ3MsIHRlc3RQYXRoKVxuICAgICAgICAuZmlsZVBhdGhUb01lc3NhZ2VzLmdldCh0ZXN0UGF0aClbMF07XG4gICAgICBleHBlY3QobWVzc2FnZSkudG9FcXVhbChleHBlY3RlZE91dHB1dCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBmaWx0ZXIgZGlhZ25vc3RpY3Mgbm90IGluIHRoZSB0YXJnZXQgZmlsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGRpYWdzID0gW1tcbiAgICAgICAge1xuICAgICAgICAgIHBhdGg6ICdub3RNeVBhdGgnLFxuICAgICAgICAgIGRlc2NyOiAnbWVzc2FnZScsXG4gICAgICAgICAgbGluZTogMSxcbiAgICAgICAgICBlbmRsaW5lOiAyLFxuICAgICAgICAgIHN0YXJ0OiAzLFxuICAgICAgICAgIGVuZDogNCxcbiAgICAgICAgICBjb2RlOiAwLFxuICAgICAgICB9LFxuICAgICAgXV07XG5cbiAgICAgIGNvbnN0IGFsbE1lc3NhZ2VzID0gZmxvd0RpYWdub3N0aWNzUHJvdmlkZXJcbiAgICAgICAgLl9wcm9jZXNzRGlhZ25vc3RpY3MoZGlhZ3MsIHRlc3RQYXRoKVxuICAgICAgICAuZmlsZVBhdGhUb01lc3NhZ2VzO1xuICAgICAgZXhwZWN0KGFsbE1lc3NhZ2VzLmhhcygnbm90TXlQYXRoJykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSB0cmFjZXMgZm9yIGRpYWdub3N0aWNzIHNwYW5uaW5nIG11bHRpcGxlIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGlhZ3MgPSBbW1xuICAgICAgICB7XG4gICAgICAgICAgbGV2ZWw6ICdlcnJvcicsXG4gICAgICAgICAgcGF0aDogdGVzdFBhdGgsXG4gICAgICAgICAgZGVzY3I6ICdtZXNzYWdlJyxcbiAgICAgICAgICBsaW5lOiAxLFxuICAgICAgICAgIGVuZGxpbmU6IDIsXG4gICAgICAgICAgc3RhcnQ6IDMsXG4gICAgICAgICAgZW5kOiA0LFxuICAgICAgICAgIGNvZGU6IDAsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBsZXZlbDogJ2Vycm9yJyxcbiAgICAgICAgICBwYXRoOiAnb3RoZXJQYXRoJyxcbiAgICAgICAgICBkZXNjcjogJ21vcmUgbWVzc2FnZScsXG4gICAgICAgICAgbGluZTogNSxcbiAgICAgICAgICBlbmRsaW5lOiA2LFxuICAgICAgICAgIHN0YXJ0OiA3LFxuICAgICAgICAgIGVuZDogOCxcbiAgICAgICAgICBjb2RlOiAwLFxuICAgICAgICB9LFxuICAgICAgXV07XG5cbiAgICAgIGNvbnN0IGV4cGVjdGVkT3V0cHV0ID0ge1xuICAgICAgICBzY29wZTogJ2ZpbGUnLFxuICAgICAgICBwcm92aWRlck5hbWU6ICdGbG93JyxcbiAgICAgICAgdHlwZTogJ0Vycm9yJyxcbiAgICAgICAgdGV4dDogJ21lc3NhZ2UnLFxuICAgICAgICBmaWxlUGF0aDogdGVzdFBhdGgsXG4gICAgICAgIHJhbmdlOiBuZXcgUmFuZ2UoWzAsIDJdLCBbMSwgNF0pLFxuICAgICAgICB0cmFjZTogW3tcbiAgICAgICAgICB0eXBlOiAnVHJhY2UnLFxuICAgICAgICAgIGZpbGVQYXRoOiAnb3RoZXJQYXRoJyxcbiAgICAgICAgICB0ZXh0OiAnbW9yZSBtZXNzYWdlJyxcbiAgICAgICAgICByYW5nZTogbmV3IFJhbmdlKFs0LCA2XSwgWzUsIDhdKSxcbiAgICAgICAgfV0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtZXNzYWdlID0gZmxvd0RpYWdub3N0aWNzUHJvdmlkZXJcbiAgICAgICAgLl9wcm9jZXNzRGlhZ25vc3RpY3MoZGlhZ3MsIHRlc3RQYXRoKVxuICAgICAgICAuZmlsZVBhdGhUb01lc3NhZ2VzLmdldCh0ZXN0UGF0aClbMF07XG4gICAgICBleHBlY3QobWVzc2FnZSkudG9FcXVhbChleHBlY3RlZE91dHB1dCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnZhbGlkYXRlUHJvamVjdFBhdGgnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgY29ycmVzcG9uZGluZyBlcnJvcnMgdG8gY2VydGFpbiBmbG93IHJvb3QnLCAoKSA9PiB7XG4gICAgICAvLyBNb2NrIGEgZGlhZ25vc3RpYyBwcm92aWRlciB3aXRoIDIgZmxvdyByb290cywgc2hhcmluZyBjb21tb24gZmlsZSByZWFsIHBhdGhzLlxuICAgICAgY29uc3QgZmxvd1Jvb3RUb0ZpbGVQYXRocyA9IG5ldyBNYXAoKTtcbiAgICAgIGNvbnN0IHJvb3QxUGF0aHMgPSBbJy9mbG93L3Jvb3QxL2ZpbGUuanMnLCAnL2Zsb3cvY29tbW9uL2ZpbGUuanMnXTtcbiAgICAgIGNvbnN0IHJvb3QyUGF0aHMgPSBbJy9mbG93L3Jvb3QyL2ZpbGUuanMnLCAnL2Zsb3cvY29tbW9uL2ZpbGUuanMnXTtcbiAgICAgIGZsb3dSb290VG9GaWxlUGF0aHMuc2V0KCcvZmxvdy9yb290MScsIG5ldyBTZXQocm9vdDFQYXRocykpO1xuICAgICAgZmxvd1Jvb3RUb0ZpbGVQYXRocy5zZXQoJy9mbG93L3Jvb3QyJywgbmV3IFNldChyb290MlBhdGhzKSk7XG4gICAgICBmbG93RGlhZ25vc3RpY3NQcm92aWRlci5fZmxvd1Jvb3RUb0ZpbGVQYXRocyA9IGZsb3dSb290VG9GaWxlUGF0aHM7XG4gICAgICAvLyBNb2NrIHRoZSBgcHVibGlzaE1lc3NhZ2VJbnZhbGlkYXRpb25gIGNhbGwgdG8gY2FwdHVyZSBjYWxsIGFyZ3VtZW50cy5cbiAgICAgIGNvbnN0IHB1Ymxpc2hIYW5kbGVyID0gamFzbWluZS5jcmVhdGVTcHkoJ3B1Ymxpc2gnKTtcbiAgICAgIGZsb3dEaWFnbm9zdGljc1Byb3ZpZGVyLl9wcm92aWRlckJhc2UucHVibGlzaE1lc3NhZ2VJbnZhbGlkYXRpb24gPSBwdWJsaXNoSGFuZGxlcjtcblxuICAgICAgZmxvd0RpYWdub3N0aWNzUHJvdmlkZXIuaW52YWxpZGF0ZVByb2plY3RQYXRoKCcvZmxvdy9yb290MScpO1xuICAgICAgZXhwZWN0KHB1Ymxpc2hIYW5kbGVyLmNhbGxDb3VudCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChwdWJsaXNoSGFuZGxlci5hcmdzRm9yQ2FsbFswXVswXSkudG9FcXVhbCh7c2NvcGU6ICdmaWxlJywgZmlsZVBhdGhzOiByb290MVBhdGhzfSk7XG4gICAgICBleHBlY3QoZmxvd0RpYWdub3N0aWNzUHJvdmlkZXIuX2Zsb3dSb290VG9GaWxlUGF0aHMuc2l6ZSkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChmbG93RGlhZ25vc3RpY3NQcm92aWRlci5fZmxvd1Jvb3RUb0ZpbGVQYXRocy5nZXQoJy9mbG93L3Jvb3QyJykpXG4gICAgICAgIC50b0VxdWFsKG5ldyBTZXQocm9vdDJQYXRocykpO1xuICAgIH0pO1xuICB9KTtcblxufSk7XG4iXX0=
//# sourceURL=/Users/zhangxiaotian/.atom/packages/nuclide-flow/spec/FlowDiagnosticsProvider-spec.js
