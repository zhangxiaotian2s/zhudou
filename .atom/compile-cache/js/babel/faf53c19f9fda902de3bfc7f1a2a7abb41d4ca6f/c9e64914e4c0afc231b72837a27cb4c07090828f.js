'use babel';

/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var _require = require('atom');

var Range = _require.Range;

var testPath = 'myPath';

describe('HackDiagnosticsProvider', function () {

  var hackDiagnosticsProvider = undefined;
  var fakeHackLanguages = undefined;

  function createFakeHackLanguage(uri) {
    return {
      _uri: uri,
      isHackAvailable: function isHackAvailable() {
        return true;
      }
    };
  }

  beforeEach(function () {
    // Mock 2 hack languages
    fakeHackLanguages = [];
    fakeHackLanguages.push(createFakeHackLanguage('/hack/root1'));
    fakeHackLanguages.push(createFakeHackLanguage('/hack/root2'));
    require('../lib/hack').getCachedHackLanguageForUri = function (uri) {
      return fakeHackLanguages.filter(function (fakeLanguage) {
        return uri.startsWith(fakeLanguage._uri);
      })[0];
    };

    var FakeProviderBase = function FakeProviderBase() {
      _classCallCheck(this, FakeProviderBase);
    };

    var HackDiagnosticsProvider = require('../lib/HackDiagnosticsProvider');
    hackDiagnosticsProvider = new HackDiagnosticsProvider(false, FakeProviderBase);
  });

  describe('processDiagnostics', function () {

    it('should propertly transform a simple diagnostic', function () {
      var diagnostics = [{
        message: [{
          path: testPath,
          descr: 'message',
          line: 1,
          start: 3,
          end: 4
        }]
      }];

      var expectedOutput = {
        scope: 'file',
        providerName: 'Hack',
        text: 'message',
        type: 'Error',
        filePath: testPath,
        range: new Range([0, 2], [0, 4])
      };

      var message = hackDiagnosticsProvider._processDiagnostics(diagnostics, testPath).filePathToMessages.get(testPath)[0];
      expect(message).toEqual(expectedOutput);
    });

    it('should not filter diagnostics not in the target file', function () {
      var diagnostics = [{
        message: [{
          path: 'notMyPath',
          descr: 'message',
          line: 1,
          start: 3,
          end: 4
        }]
      }];

      var allMessages = hackDiagnosticsProvider._processDiagnostics(diagnostics, testPath).filePathToMessages;
      expect(allMessages.size).toBe(1);
      expect(allMessages.has('notMyPath')).toBe(true);
    });

    it('should create traces for diagnostics on multiple messages and combine the text', function () {
      var diagnostics = [{
        message: [{
          path: testPath,
          descr: 'message',
          line: 1,
          start: 3,
          end: 4
        }, {
          path: 'otherPath',
          descr: 'more message',
          line: 5,
          start: 7,
          end: 8
        }]
      }];

      var expectedOutput = {
        scope: 'file',
        providerName: 'Hack',
        type: 'Error',
        text: 'message',
        filePath: testPath,
        range: new Range([0, 2], [0, 4]),
        trace: [{
          type: 'Trace',
          filePath: 'otherPath',
          text: 'more message',
          range: new Range([4, 6], [4, 8])
        }]
      };

      var message = hackDiagnosticsProvider._processDiagnostics(diagnostics, testPath).filePathToMessages.get(testPath)[0];
      expect(message).toEqual(expectedOutput);
    });
  });

  describe('invalidateProjectPath', function () {
    it('should remove corresponding errors to certain hack language', function () {
      // Mock a diagnostic provider with 2 hack language roots, sharing common file real paths.
      var hackLanguageToFilePaths = new Map();
      var root1Paths = ['/hack/root1/file.js', '/hack/common/file.js'];
      var root2Paths = ['/hack/root2/file.js', '/hack/common/file.js'];
      hackLanguageToFilePaths.set(fakeHackLanguages[0], new Set(root1Paths));
      hackLanguageToFilePaths.set(fakeHackLanguages[1], new Set(root2Paths));
      hackDiagnosticsProvider._hackLanguageToFilePaths = hackLanguageToFilePaths;
      // Mock the `publishMessageInvalidation` call to capture call arguments.
      var publishHandler = jasmine.createSpy('publish');
      hackDiagnosticsProvider._providerBase.publishMessageInvalidation = publishHandler;

      hackDiagnosticsProvider.invalidateProjectPath('/hack/root1');
      expect(publishHandler.callCount).toBe(1);
      expect(publishHandler.argsForCall[0][0]).toEqual({ scope: 'file', filePaths: root1Paths });
      expect(hackDiagnosticsProvider._hackLanguageToFilePaths.size).toBe(1);
      expect(hackDiagnosticsProvider._hackLanguageToFilePaths.get(fakeHackLanguages[1])).toEqual(new Set(root2Paths));
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy96aGFuZ3hpYW90aWFuLy5hdG9tL3BhY2thZ2VzL251Y2xpZGUtaGFjay9zcGVjL0hhY2tEaWFnbm9zdGljc1Byb3ZpZGVyLXNwZWMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsV0FBVyxDQUFDOzs7Ozs7Ozs7Ozs7ZUFXSSxPQUFPLENBQUMsTUFBTSxDQUFDOztJQUF4QixLQUFLLFlBQUwsS0FBSzs7QUFFWixJQUFNLFFBQVEsR0FBRyxRQUFRLENBQUM7O0FBRTFCLFFBQVEsQ0FBQyx5QkFBeUIsRUFBRSxZQUFNOztBQUV4QyxNQUFJLHVCQUE0QixZQUFBLENBQUM7QUFDakMsTUFBSSxpQkFBNkIsWUFBQSxDQUFDOztBQUVsQyxXQUFTLHNCQUFzQixDQUFDLEdBQVcsRUFBRTtBQUMzQyxXQUFPO0FBQ0wsVUFBSSxFQUFFLEdBQUc7QUFDVCxxQkFBZSxFQUFFO2VBQU0sSUFBSTtPQUFBO0tBQzVCLENBQUM7R0FDSDs7QUFFRCxZQUFVLENBQUMsWUFBTTs7QUFFZixxQkFBaUIsR0FBRyxFQUFFLENBQUM7QUFDdkIscUJBQWlCLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7QUFDOUQscUJBQWlCLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7QUFDOUQsV0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLDJCQUEyQixHQUFHLFVBQUMsR0FBRzthQUN2RCxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsVUFBQSxZQUFZO2VBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDO09BQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUFBLENBQUM7O1FBQzNFLGdCQUFnQixZQUFoQixnQkFBZ0I7NEJBQWhCLGdCQUFnQjs7O0FBQ3RCLFFBQU0sdUJBQXVCLEdBQUcsT0FBTyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7QUFDMUUsMkJBQXVCLEdBQUcsSUFBSSx1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QyxDQUFDO0FBQzdELFlBQU0sQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3pDLFlBQU0sQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFDLENBQUMsQ0FBQztBQUN6RixZQUFNLENBQUMsdUJBQXVCLENBQUMsd0JBQXdCLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3RFLFlBQU0sQ0FBQyx1QkFBdUIsQ0FBQyx3QkFBd0IsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUMvRSxPQUFPLENBQUMsSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztLQUNqQyxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoiL1VzZXJzL3poYW5neGlhb3RpYW4vLmF0b20vcGFja2FnZXMvbnVjbGlkZS1oYWNrL3NwZWMvSGFja0RpYWdub3N0aWNzUHJvdmlkZXItc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuLyogQGZsb3cgKi9cblxuLypcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBsaWNlbnNlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgaW5cbiAqIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cbmNvbnN0IHtSYW5nZX0gPSByZXF1aXJlKCdhdG9tJyk7XG5cbmNvbnN0IHRlc3RQYXRoID0gJ215UGF0aCc7XG5cbmRlc2NyaWJlKCdIYWNrRGlhZ25vc3RpY3NQcm92aWRlcicsICgpID0+IHtcblxuICBsZXQgaGFja0RpYWdub3N0aWNzUHJvdmlkZXI6IGFueTtcbiAgbGV0IGZha2VIYWNrTGFuZ3VhZ2VzOiBBcnJheTxhbnk+O1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUZha2VIYWNrTGFuZ3VhZ2UodXJpOiBzdHJpbmcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgX3VyaTogdXJpLFxuICAgICAgaXNIYWNrQXZhaWxhYmxlOiAoKSA9PiB0cnVlLFxuICAgIH07XG4gIH1cblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAvLyBNb2NrIDIgaGFjayBsYW5ndWFnZXNcbiAgICBmYWtlSGFja0xhbmd1YWdlcyA9IFtdO1xuICAgIGZha2VIYWNrTGFuZ3VhZ2VzLnB1c2goY3JlYXRlRmFrZUhhY2tMYW5ndWFnZSgnL2hhY2svcm9vdDEnKSk7XG4gICAgZmFrZUhhY2tMYW5ndWFnZXMucHVzaChjcmVhdGVGYWtlSGFja0xhbmd1YWdlKCcvaGFjay9yb290MicpKTtcbiAgICByZXF1aXJlKCcuLi9saWIvaGFjaycpLmdldENhY2hlZEhhY2tMYW5ndWFnZUZvclVyaSA9ICh1cmkpID0+XG4gICAgICBmYWtlSGFja0xhbmd1YWdlcy5maWx0ZXIoZmFrZUxhbmd1YWdlID0+IHVyaS5zdGFydHNXaXRoKGZha2VMYW5ndWFnZS5fdXJpKSlbMF07XG4gICAgY2xhc3MgRmFrZVByb3ZpZGVyQmFzZSB7IH1cbiAgICBjb25zdCBIYWNrRGlhZ25vc3RpY3NQcm92aWRlciA9IHJlcXVpcmUoJy4uL2xpYi9IYWNrRGlhZ25vc3RpY3NQcm92aWRlcicpO1xuICAgIGhhY2tEaWFnbm9zdGljc1Byb3ZpZGVyID0gbmV3IEhhY2tEaWFnbm9zdGljc1Byb3ZpZGVyKFxuICAgICAgZmFsc2UsXG4gICAgICAoRmFrZVByb3ZpZGVyQmFzZTogYW55KSxcbiAgICApO1xuICB9KTtcblxuICBkZXNjcmliZSgncHJvY2Vzc0RpYWdub3N0aWNzJywgKCkgPT4ge1xuXG4gICAgaXQoJ3Nob3VsZCBwcm9wZXJ0bHkgdHJhbnNmb3JtIGEgc2ltcGxlIGRpYWdub3N0aWMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkaWFnbm9zdGljcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIG1lc3NhZ2U6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcGF0aDogdGVzdFBhdGgsXG4gICAgICAgICAgICAgIGRlc2NyOiAnbWVzc2FnZScsXG4gICAgICAgICAgICAgIGxpbmU6IDEsXG4gICAgICAgICAgICAgIHN0YXJ0OiAzLFxuICAgICAgICAgICAgICBlbmQ6IDQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBleHBlY3RlZE91dHB1dCA9IHtcbiAgICAgICAgc2NvcGU6ICdmaWxlJyxcbiAgICAgICAgcHJvdmlkZXJOYW1lOiAnSGFjaycsXG4gICAgICAgIHRleHQ6ICdtZXNzYWdlJyxcbiAgICAgICAgdHlwZTogJ0Vycm9yJyxcbiAgICAgICAgZmlsZVBhdGg6IHRlc3RQYXRoLFxuICAgICAgICByYW5nZTogbmV3IFJhbmdlKFswLCAyXSwgWzAsIDRdKSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBoYWNrRGlhZ25vc3RpY3NQcm92aWRlclxuICAgICAgICAuX3Byb2Nlc3NEaWFnbm9zdGljcyhkaWFnbm9zdGljcywgdGVzdFBhdGgpXG4gICAgICAgIC5maWxlUGF0aFRvTWVzc2FnZXMuZ2V0KHRlc3RQYXRoKVswXTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0VxdWFsKGV4cGVjdGVkT3V0cHV0KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGZpbHRlciBkaWFnbm9zdGljcyBub3QgaW4gdGhlIHRhcmdldCBmaWxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGlhZ25vc3RpY3MgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBtZXNzYWdlOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHBhdGg6ICdub3RNeVBhdGgnLFxuICAgICAgICAgICAgICBkZXNjcjogJ21lc3NhZ2UnLFxuICAgICAgICAgICAgICBsaW5lOiAxLFxuICAgICAgICAgICAgICBzdGFydDogMyxcbiAgICAgICAgICAgICAgZW5kOiA0LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgYWxsTWVzc2FnZXMgPSBoYWNrRGlhZ25vc3RpY3NQcm92aWRlclxuICAgICAgICAuX3Byb2Nlc3NEaWFnbm9zdGljcyhkaWFnbm9zdGljcywgdGVzdFBhdGgpXG4gICAgICAgIC5maWxlUGF0aFRvTWVzc2FnZXM7XG4gICAgICBleHBlY3QoYWxsTWVzc2FnZXMuc2l6ZSkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChhbGxNZXNzYWdlcy5oYXMoJ25vdE15UGF0aCcpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgdHJhY2VzIGZvciBkaWFnbm9zdGljcyBvbiBtdWx0aXBsZSBtZXNzYWdlcyBhbmQgY29tYmluZSB0aGUgdGV4dCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGRpYWdub3N0aWNzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgbWVzc2FnZTogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBwYXRoOiB0ZXN0UGF0aCxcbiAgICAgICAgICAgICAgZGVzY3I6ICdtZXNzYWdlJyxcbiAgICAgICAgICAgICAgbGluZTogMSxcbiAgICAgICAgICAgICAgc3RhcnQ6IDMsXG4gICAgICAgICAgICAgIGVuZDogNCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHBhdGg6ICdvdGhlclBhdGgnLFxuICAgICAgICAgICAgICBkZXNjcjogJ21vcmUgbWVzc2FnZScsXG4gICAgICAgICAgICAgIGxpbmU6IDUsXG4gICAgICAgICAgICAgIHN0YXJ0OiA3LFxuICAgICAgICAgICAgICBlbmQ6IDgsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBleHBlY3RlZE91dHB1dCA9IHtcbiAgICAgICAgc2NvcGU6ICdmaWxlJyxcbiAgICAgICAgcHJvdmlkZXJOYW1lOiAnSGFjaycsXG4gICAgICAgIHR5cGU6ICdFcnJvcicsXG4gICAgICAgIHRleHQ6ICdtZXNzYWdlJyxcbiAgICAgICAgZmlsZVBhdGg6IHRlc3RQYXRoLFxuICAgICAgICByYW5nZTogbmV3IFJhbmdlKFswLCAyXSwgWzAsIDRdKSxcbiAgICAgICAgdHJhY2U6IFt7XG4gICAgICAgICAgdHlwZTogJ1RyYWNlJyxcbiAgICAgICAgICBmaWxlUGF0aDogJ290aGVyUGF0aCcsXG4gICAgICAgICAgdGV4dDogJ21vcmUgbWVzc2FnZScsXG4gICAgICAgICAgcmFuZ2U6IG5ldyBSYW5nZShbNCwgNl0sIFs0LCA4XSksXG4gICAgICAgIH1dLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbWVzc2FnZSA9IGhhY2tEaWFnbm9zdGljc1Byb3ZpZGVyXG4gICAgICAgIC5fcHJvY2Vzc0RpYWdub3N0aWNzKGRpYWdub3N0aWNzLCB0ZXN0UGF0aClcbiAgICAgICAgLmZpbGVQYXRoVG9NZXNzYWdlcy5nZXQodGVzdFBhdGgpWzBdO1xuICAgICAgZXhwZWN0KG1lc3NhZ2UpLnRvRXF1YWwoZXhwZWN0ZWRPdXRwdXQpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaW52YWxpZGF0ZVByb2plY3RQYXRoJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIGNvcnJlc3BvbmRpbmcgZXJyb3JzIHRvIGNlcnRhaW4gaGFjayBsYW5ndWFnZScsICgpID0+IHtcbiAgICAgIC8vIE1vY2sgYSBkaWFnbm9zdGljIHByb3ZpZGVyIHdpdGggMiBoYWNrIGxhbmd1YWdlIHJvb3RzLCBzaGFyaW5nIGNvbW1vbiBmaWxlIHJlYWwgcGF0aHMuXG4gICAgICBjb25zdCBoYWNrTGFuZ3VhZ2VUb0ZpbGVQYXRocyA9IG5ldyBNYXAoKTtcbiAgICAgIGNvbnN0IHJvb3QxUGF0aHMgPSBbJy9oYWNrL3Jvb3QxL2ZpbGUuanMnLCAnL2hhY2svY29tbW9uL2ZpbGUuanMnXTtcbiAgICAgIGNvbnN0IHJvb3QyUGF0aHMgPSBbJy9oYWNrL3Jvb3QyL2ZpbGUuanMnLCAnL2hhY2svY29tbW9uL2ZpbGUuanMnXTtcbiAgICAgIGhhY2tMYW5ndWFnZVRvRmlsZVBhdGhzLnNldChmYWtlSGFja0xhbmd1YWdlc1swXSwgbmV3IFNldChyb290MVBhdGhzKSk7XG4gICAgICBoYWNrTGFuZ3VhZ2VUb0ZpbGVQYXRocy5zZXQoZmFrZUhhY2tMYW5ndWFnZXNbMV0sIG5ldyBTZXQocm9vdDJQYXRocykpO1xuICAgICAgaGFja0RpYWdub3N0aWNzUHJvdmlkZXIuX2hhY2tMYW5ndWFnZVRvRmlsZVBhdGhzID0gaGFja0xhbmd1YWdlVG9GaWxlUGF0aHM7XG4gICAgICAvLyBNb2NrIHRoZSBgcHVibGlzaE1lc3NhZ2VJbnZhbGlkYXRpb25gIGNhbGwgdG8gY2FwdHVyZSBjYWxsIGFyZ3VtZW50cy5cbiAgICAgIGNvbnN0IHB1Ymxpc2hIYW5kbGVyID0gamFzbWluZS5jcmVhdGVTcHkoJ3B1Ymxpc2gnKTtcbiAgICAgIGhhY2tEaWFnbm9zdGljc1Byb3ZpZGVyLl9wcm92aWRlckJhc2UucHVibGlzaE1lc3NhZ2VJbnZhbGlkYXRpb24gPSBwdWJsaXNoSGFuZGxlcjtcblxuICAgICAgaGFja0RpYWdub3N0aWNzUHJvdmlkZXIuaW52YWxpZGF0ZVByb2plY3RQYXRoKCcvaGFjay9yb290MScpO1xuICAgICAgZXhwZWN0KHB1Ymxpc2hIYW5kbGVyLmNhbGxDb3VudCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChwdWJsaXNoSGFuZGxlci5hcmdzRm9yQ2FsbFswXVswXSkudG9FcXVhbCh7c2NvcGU6ICdmaWxlJywgZmlsZVBhdGhzOiByb290MVBhdGhzfSk7XG4gICAgICBleHBlY3QoaGFja0RpYWdub3N0aWNzUHJvdmlkZXIuX2hhY2tMYW5ndWFnZVRvRmlsZVBhdGhzLnNpemUpLnRvQmUoMSk7XG4gICAgICBleHBlY3QoaGFja0RpYWdub3N0aWNzUHJvdmlkZXIuX2hhY2tMYW5ndWFnZVRvRmlsZVBhdGhzLmdldChmYWtlSGFja0xhbmd1YWdlc1sxXSkpXG4gICAgICAgIC50b0VxdWFsKG5ldyBTZXQocm9vdDJQYXRocykpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19
//# sourceURL=/Users/zhangxiaotian/.atom/packages/nuclide-hack/spec/HackDiagnosticsProvider-spec.js
